<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Accessing doit internal database" name="description" />
<meta content="python, doit, documentation, guide, database, status" name="keywords" />

      <title>Accessing doit internal database - pydoit guide</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
      <link rel="canonical" href="https://pydoit.org/globals.html" />
    
      <link rel="shortcut icon" href="_static/favico.ico"/>
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="custom up-to-date" href="uptodate.html" />
  <link rel="prev" title="Passing arguments from the command line" href="task-args.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="contents.html" class="home-link">
    
      <img class="logo" src="_static/doit-logo-small.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="contents.html#getting-started"
         class="nav-link ">
         getting started
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#guide"
         class="nav-link  router-link-active">
         guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#project"
         class="nav-link ">
         project
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://twitter.com/pydoit"
        class="nav-link external">
          Twitter <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/pydoit/doit"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="contents.html#getting-started"
         class="nav-link ">
         getting started
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#guide"
         class="nav-link  router-link-active">
         guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#project"
         class="nav-link ">
         project
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://twitter.com/pydoit"
        class="nav-link external">
          Twitter <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/pydoit/doit"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="contents.html#getting-started">getting started</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="usecases.html" class="reference internal ">Use Cases</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tutorial-1.html" class="reference internal ">tutorial - python imports graph</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="contents.html#guide">guide</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="install.html" class="reference internal ">Installing</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tasks.html" class="reference internal ">Tasks</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="dependencies.html" class="reference internal ">Non-file dependencies</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="task-creation.html" class="reference internal ">More on Task creation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd-run.html" class="reference internal ">Command line interface - run</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd-other.html" class="reference internal ">sub-commands for task manipulation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="configuration.html" class="reference internal ">Configuration</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="task-args.html" class="reference internal ">Passing arguments from the command line</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Globals - accessing doit internals</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#dep-manager" class="reference internal">dep_manager</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="uptodate.html" class="reference internal ">custom up-to-date</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tools.html" class="reference internal ">Tools & Integrations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="extending.html" class="reference internal ">Extending doit</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="contents.html#project">project</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="support.html" class="reference internal ">Support</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="changes.html" class="reference internal ">Changes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="stories.html" class="reference internal ">Success Stories</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="faq.html" class="reference internal ">FAQ</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="related.html" class="reference internal ">Related Projects</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>

  
    <div style="margin-bottom: 0px; padding:1rem; background-color: #2980B9; color:#fcfcfc;">
      <h3>Donate</h3>
      <p>If you find <em>doit</em> useful, please consider supporting the maintainer with a donation.</p>
      <p><em>doit</em> is 100% open-source and maintained by individuals without any company backing it... Your donation keeps the project healthy and maintained.</p>
    </div>

    <div style="text-align:center; padding:1rem; color:black;background-color:#fcfcfc; margin-bottom:2rem;">
      <h4 style="margin-bottom:5px;margin-top:5px;">OpenCollective</h4>
      <div>
        <object type="image/svg+xml" data="https://opencollective.com/doit/tiers/backers.svg?avatarHeight=60&width=200"></object>
      </div>

      <hr style="margin-top:5px;">
      <h4 style="margin-bottom:20px;">Paypal</h4>
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" style="margin:auto;">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="hosted_button_id" value="GFU3BPVN586A6">
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" border="0" src="https://www.paypalobjects.com/pt_BR/i/scr/pixel.gif" width="1" height="1" style="visibility:hidden;">
      </form>
    </div>
    <br>
  

        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="contents.html">Docs</a> &raquo;</li>
    
    <li>Accessing doit internal database  - pydoit guide</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="task-args.html"
       title="previous chapter">← Passing arguments from the command line</a>
  </li>
  <li class="next">
    <a href="uptodate.html"
       title="next chapter">custom up-to-date →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="globals-accessing-doit-internals">
<h1>Globals - accessing doit internals<a class="headerlink" href="#globals-accessing-doit-internals" title="Permalink to this headline">¶</a></h1>
<p>During the life-cycle of a command invocation,
some properties of <cite>doit</cite> are stored in global singletons,
provided by the <code class="docutils literal notranslate"><span class="pre">doit.Globals</span></code> class.</p>
<dl class="py class">
<dt class="sig sig-object py" id="doit.globals.Globals">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">doit.globals.</span></span><span class="sig-name descname"><span class="pre">Globals</span></span><a class="reference internal" href="_modules/doit/globals.html#Globals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#doit.globals.Globals" title="Permalink to this definition">¶</a></dt>
<dd><p>Accessors to doit singletons.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><p><strong>dep_manager</strong> – (doit.dependency.Dependency) The doit dependency manager,
holding all persistent task data.</p>
</dd>
</dl>
</dd></dl>

<section id="dep-manager">
<h2>dep_manager<a class="headerlink" href="#dep-manager" title="Permalink to this headline">¶</a></h2>
<p>The doit dependency manager holds the persistent state of <cite>doit</cite>.
This includes relations of tasks among each other or results,
returned from their latest runs. It basically consists of all the
information stored in <cite>doit</cite>’s database file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dep_manager</span></code> attribute is initialized right before tasks are loaded,
which means it allows to be accessed during <em>all</em> task evaluation phases,
in particular during:</p>
<ul class="simple">
<li><p>Task creation, i.e. from the body of any <code class="docutils literal notranslate"><span class="pre">task_*</span></code> function.</p></li>
<li><p>Task execution, i.e. from the code executed by one of the task’s actions.</p></li>
<li><p>Task cleanup, i.e. from the the code executed by one of the tasks’s clean activities.</p></li>
</ul>
<p>The <cite>Dependency</cite> class has members to access persistent doit data via its API:</p>
<dl class="py class">
<dt class="sig sig-object py" id="doit.dependency.Dependency">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">doit.dependency.</span></span><span class="sig-name descname"><span class="pre">Dependency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checker_cls=&lt;class</span> <span class="pre">'doit.dependency.MD5Checker'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec_cls=&lt;class</span> <span class="pre">'doit.dependency.JSONCodec'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module_name=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/doit/dependency.html#Dependency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#doit.dependency.Dependency" title="Permalink to this definition">¶</a></dt>
<dd><p>Manage tasks dependencies.</p>
<p>Each dependency is saved in “db”. There are several “db” backends.
It uses a Key-Value format where the key is task-name
and value is a dictionary.
Each task has a dictionary where keys are <cite>dependency</cite>’s (absolute file path),
and the value is the dependency signature.
Apart from dependencies other values are also saved on the task dictionary:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_values_:</span></code> task’s values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result:</span></code> task result</p></li>
</ul>
<p>And also some internal doit attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ignore:</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deps:</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checker:</span></code></p></li>
</ul>
<p>Those can be accessed with generic DB <code class="docutils literal notranslate"><span class="pre">get()</span></code>, see below…</p>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>string</em>) – filepath of the DB file</p></li>
<li><p><strong>_closed</strong> (<em>bool</em>) – DB was flushed to file</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="doit.dependency.Dependency.get_result">
<span class="sig-name descname"><span class="pre">get_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/doit/dependency.html#Dependency.get_result"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#doit.dependency.Dependency.get_result" title="Permalink to this definition">¶</a></dt>
<dd><p>get the result saved from a task</p>
<dl class="field-list simple">
<dt class="field-odd">Return (dict or md5sum)</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="doit.dependency.Dependency.get_value">
<span class="sig-name descname"><span class="pre">get_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/doit/dependency.html#Dependency.get_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#doit.dependency.Dependency.get_value" title="Permalink to this definition">¶</a></dt>
<dd><p>get saved value from task</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_id</strong> (<em>str</em>) – </p></li>
<li><p><strong>key_name</strong> (<em>str</em>) – key result dict of the value</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="doit.dependency.Dependency.get_values">
<span class="sig-name descname"><span class="pre">get_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/doit/dependency.html#Dependency.get_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#doit.dependency.Dependency.get_values" title="Permalink to this definition">¶</a></dt>
<dd><p>get all saved values from a task</p>
<dl class="field-list simple">
<dt class="field-odd">Return dict</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

</dd></dl>

<p>The class internally interacts with a data base backend
which may be accessed via the <cite>backend</cite> attribute.
An experienced user may also <em>modify</em> persistently stored <em>doit</em> data through that attribute.
As an example of a backend API,
look at the common methods exposed by the default <cite>DbmDB</cite> backend implementation:</p>
<dl class="py class">
<dt class="sig sig-object py" id="doit.dependency.DbmDB">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">doit.dependency.</span></span><span class="sig-name descname"><span class="pre">DbmDB</span></span><a class="headerlink" href="#doit.dependency.DbmDB" title="Permalink to this definition">¶</a></dt>
<dd><p>A simple Key-Value database interface</p>
<dl class="py method">
<dt class="sig sig-object py" id="doit.dependency.doit.dependency.DbmDB.DbmDB.get">
<span class="sig-prename descclassname"><span class="pre">DbmDB.</span></span><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependency</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doit.dependency.doit.dependency.DbmDB.DbmDB.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get value stored in the DB.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>string or None if entry not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="doit.dependency.doit.dependency.DbmDB.DbmDB.set">
<span class="sig-prename descclassname"><span class="pre">DbmDB.</span></span><span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doit.dependency.doit.dependency.DbmDB.DbmDB.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Store value in the DB.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="doit.dependency.doit.dependency.DbmDB.DbmDB.remove">
<span class="sig-prename descclassname"><span class="pre">DbmDB.</span></span><span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doit.dependency.doit.dependency.DbmDB.DbmDB.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>remove saved dependencies from DB for taskId</p>
</dd></dl>

</dd></dl>

<p>There are other backends available in <em>doit</em>,
see the documentation on <a class="reference internal" href="cmd-run.html#db-backends"><span class="std std-ref">DB backend</span></a> on how to select between them.</p>
<section id="dep-manager-example">
<h3><code class="docutils literal notranslate"><span class="pre">dep_manager</span></code> example<a class="headerlink" href="#dep-manager-example" title="Permalink to this headline">¶</a></h3>
<p>An example of using the exposed dependency manager is a task,
where at creation time the <em>target</em> of the task action is not yet known,
because it is determined during execution.
Then it would be possible to store that target in the dependency manager
by returning it from the action.
A <cite>clean</cite> action is subsequently able to query <cite>dep_manager</cite> for that result
and perform the cleanup action:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">doit</span>

<span class="n">DOIT_CONFIG</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">task_create</span><span class="p">():</span>
    <span class="c1"># dependency manager is defined for all code inside the generator:</span>
    <span class="n">dep_manager</span> <span class="o">=</span> <span class="n">doit</span><span class="o">.</span><span class="n">Globals</span><span class="o">.</span><span class="n">dep_manager</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">():</span>
        <span class="c1"># assume some involved logic to define ident:</span>
        <span class="n">ident</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Created&#39;</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span>

        <span class="c1"># store for clean:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">created</span><span class="o">=</span><span class="n">ident</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dep_manager</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">ident</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleted&#39;</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span>

            <span class="c1"># possibly forget the task, after it was cleaned:</span>
            <span class="n">dep_manager</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">action</span><span class="p">],</span>
        <span class="n">clean</span><span class="o">=</span><span class="p">[</span><span class="n">clean</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="task-args.html"
       title="previous chapter">← Passing arguments from the command line</a>
  </li>
  <li class="next">
    <a href="uptodate.html"
       title="next chapter">custom up-to-date →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2008-2020, Eduardo Schettino.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
  
    
  
    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-29887834-3', 'auto');
        ga('send', 'pageview');
      </script>
    
  

  </body>
</html>