<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tasks &mdash; doit - automation tool</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.27',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favico.ico"/>
    <link rel="top" title="doit - automation tool" href="index.html" />
    <link rel="next" title="More on dependencies" href="dependencies.html" />
    <link rel="prev" title="Installing" href="install.html" />
<style>
  body {
    font-size: 16px;
  }

  div.topic {
    padding: 2px;
    background-color: #F8F4A6;
    border: none;
  }

  p.topic-title {
    display: run-in;
    margin-right: 15px;
  }

  a.external-link {
    background: url(_static/external.png) center right no-repeat;
    padding-right: 13px;
  }

  div.related ul li a.external-link {
    padding-right: 13px;
  }

  .sidebartext {
    font-size: 75%;
    line-height: 130%;
  }

</style>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29887834-3']);
  _gaq.push(['_setDomainName', 'pydoit.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 50px">
<img src="_static/doit.png" alt="doit logo" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="dependencies.html" title="More on dependencies"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="install.html" title="Installing"
             accesskey="P">previous</a> |</li>
  <li><a href="index.html">Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&nbsp;|&nbsp;</li>
  <!-- TODO news -->
  <li><a class="external-link" href="https://github.com/pydoit/doit">Code</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="https://github.com/pydoit/doit/issues">Issues</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://pypi.python.org/pypi/doit">Download</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://groups.google.co.in/group/python-doit">Forum</a></li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tasks</a><ul>
<li><a class="reference internal" href="#intro">Intro</a></li>
<li><a class="reference internal" href="#actions">Actions</a><ul>
<li><a class="reference internal" href="#python-action">python-action</a></li>
<li><a class="reference internal" href="#cmd-action">cmd-action</a></li>
<li><a class="reference internal" href="#custom-actions">custom actions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#task-name">task name</a></li>
<li><a class="reference internal" href="#sub-tasks">sub-tasks</a><ul>
<li><a class="reference internal" href="#avoiding-empty-sub-tasks">avoiding empty sub-tasks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dependencies-targets">Dependencies &amp; Targets</a></li>
<li><a class="reference internal" href="#file-dep-file-dependency">file_dep (file dependency)</a></li>
<li><a class="reference internal" href="#targets">targets</a></li>
<li><a class="reference internal" href="#execution-order">execution order</a></li>
<li><a class="reference internal" href="#task-selection">Task selection</a><ul>
<li><a class="reference internal" href="#doit-config-default-tasks">DOIT_CONFIG -&gt; default_tasks</a></li>
<li><a class="reference internal" href="#command-line-selection">command line selection</a></li>
<li><a class="reference internal" href="#sub-task-selection">sub-task selection</a></li>
<li><a class="reference internal" href="#wildcard-selection">wildcard selection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arguments">arguments</a><ul>
<li><a class="reference internal" href="#all-parameters-attributes">All parameters attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#positional-arguments">positional arguments</a></li>
<li><a class="reference internal" href="#command-line-variables-doit-get-var">command line variables (<em>doit.get_var</em>)</a></li>
<li><a class="reference internal" href="#private-hidden-tasks">private/hidden tasks</a></li>
<li><a class="reference internal" href="#title">title</a></li>
<li><a class="reference internal" href="#verbosity">verbosity</a></li>
<li><a class="reference internal" href="#custom-task-definition">custom task definition</a></li>
<li><a class="reference internal" href="#importing-tasks">importing tasks</a></li>
</ul>
</li>
</ul>



<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

<h3>Sponsors</h3>
<em>Your logo here</em>

<h3>Sponsor/Donate</h3>


<div data-gratipay-username="schettino72" data-gratipay-widget="custom">
  <div><a class="gratipay-profile-link">Gratipay</a> weekly funding goal is <span class="gratipay-goal">$?.??</span> USD.
  </div>
  <div style="position:relative;background-color:#2F2D2D;color:#DDDDDD;border-radius:5px;margin:3px 5px;padding:3px 0;">
    <div class="gratipay-goal-progress-bar" style="position:absolute;top:3px;background-color:#008000;height:24px;border-radius:2px;"></div>
    <span class="gratipay-receiving" style="position:relative;padding-left:6px;">$?.??</span>
  </div>
</div>
<script src="//grtp.co/v1.js"></script>

<br/>

<div class="sidebartext">
Why Donate? Help keep the project alive! Donations will be used for project maintanance tasks (bug fixes, merge patches, reply users).<br/>
  <script data-gratipay-username="schettino72"
        data-gratipay-widget="button"
        src="//gttp.co/v1.js"></script>
<br/>
For corporate donations the logo of your company will be placed on this website side-bar (see above). For more information please contact <em>schettino72</em>&#64<span>gmail.com</span><br/>
</div>

<h3>Hire me</h3>
<div class="sidebartext">
Looking for a python developer with a proven record of designing and developing
robust and well tested applications?
The creator and maintainer of <em>doit</em> is available for hire.
Full-time, part-time or one-off job.
<br/>
Contact: <em>schettino72</em>&#64<span>gmail.com</span>
</div>




<h3></h3>
<a href="http://python.org"><img src="_static/python-powered-w-100x40.png" /></a><br/><br/>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p><cite>doit</cite> is all about automating task dependency management and execution.
Tasks can execute external shell commands/scripts or python functions
(actually any callable).
So a task can be anything you can code :)</p>
<p>Tasks are defined in plain <a class="reference external" href="http://python.org/">python</a> module with some
conventions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should be comfortable with python basics. If you don&#8217;t know python yet
check <a class="reference external" href="http://docs.python.org/tut/">Python tutorial</a>.</p>
</div>
<p>A function that starts with the name <cite>task_</cite> defines a <em>task-creator</em> recognized
by <cite>doit</cite>.
These functions must return (or yield) dictionaries representing a <em>task</em>.
A python module/file that defines <em>tasks</em> for <cite>doit</cite> is called <strong>dodo</strong> file
(that is something like a <cite>Makefile</cite> for <cite>make</cite>).</p>
<p>Take a look at this example (file dodo.py):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">python_hello</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Python says Hello World!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">python_hello</span><span class="p">],</span>
        <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;hello.txt&quot;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>When <cite>doit</cite> is executed without any parameters it will look for tasks in a
file named <cite>dodo.py</cite> in the current folder and execute its tasks.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  hello</span>
</pre></div>
</div>
<p>On the output it displays which tasks were executed.
In this case the <cite>dodo</cite> file has only one task, <cite>hello</cite>.</p>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>Every <em>task</em> must define <strong>actions</strong>.
It can optionally define other attributes like <cite>targets</cite>, <cite>file_dep</cite>,
<cite>verbosity</cite>, <cite>doc</cite> ...</p>
<p>Actions define what the task actually does.
<em>Actions</em> is always a list that can have any number of elements.
The actions of a task are always run sequentially.
There 2 basic kinds of <cite>actions</cite>: <em>cmd-action</em> and <em>python-action</em>.
The action &#8220;result&#8221; is used to determine if task execution was successful or not.</p>
<div class="section" id="python-action">
<h3>python-action<a class="headerlink" href="#python-action" title="Permalink to this headline">¶</a></h3>
<p>If <cite>action</cite> is a python callable or a tuple <cite>(callable, *args, **kwargs)</cite>
- only <cite>callable</cite> is required.
The callable must be a function, method or callable object.
Classes and built-in functions are not allowed.
<tt class="docutils literal"><span class="pre">args</span></tt> is a sequence and <tt class="docutils literal"><span class="pre">kwargs</span></tt> is a dictionary that will be used
as positional and keywords arguments for the callable.
see <a class="reference external" href="http://docs.python.org/tutorial/controlflow.html#keyword-arguments">Keyword Arguments</a>.</p>
<p>The result of the task is given by the returned value of the <tt class="docutils literal"><span class="pre">action</span></tt> function.
So it must return a <em>boolean</em> value <cite>True</cite>, <cite>None</cite>,
a dictionary or a string to indicate successful completion of the task.
Use <cite>False</cite> to indicate task failed.
If it raises an exception, it will be considered an error.
If it returns any other type it will also be considered an error
but this behavior might change in future versions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello py &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">python_hello</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">times</span> <span class="o">*</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">python_hello</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;py!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])],</span>
            <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;hello.txt&quot;</span><span class="p">],</span>
            <span class="p">}</span>
</pre></div>
</div>
<p>The function <cite>task_hello</cite> is a <em>task-creator</em>, not the task itself.
The body of the task-creator function is always executed when the dodo
file is loaded.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The body of task-creators are executed even if the task is not going
to be executed.
The body of task-creators should be used to create task metadata only,
not execute tasks!
From now on when the  documentation says that a <em>task</em> is executed,
read &#8220;the task&#8217;s actions are executed&#8221;.</p>
</div>
</div>
<div class="section" id="cmd-action">
<h3>cmd-action<a class="headerlink" href="#cmd-action" title="Permalink to this headline">¶</a></h3>
<p>CmdAction&#8217;s are executed in a subprocess (using python
<a class="reference external" href="http://docs.python.org/library/subprocess.html#popen-constructor">subprocess.Popen</a>).</p>
<p>If <cite>action</cite> is a string, the command will be executed through the shell.
(Popen argument shell=True).</p>
<p>Note that the string must be escaped according to
<a class="reference external" href="http://docs.python.org/library/stdtypes.html#string-formatting-operations">python string formatting</a>.</p>
<p>It is easy to include dynamic (on-the-fly) behavior to your tasks with
python code from the <cite>dodo</cite> file. Let&#8217;s take a look at another example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello cmd &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="s">&quot;hi! &quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">msg</span> <span class="o">+</span> <span class="s">&#39; &gt; </span><span class="si">%(targets)s</span><span class="s">&#39;</span><span class="p">,],</span>
        <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;hello.txt&quot;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The body of the <em>task-creator</em> is always executed,
so in this example the line <cite>msg = 3 * &#8220;hi! &#8220;</cite> will always be executed.</p>
</div>
<p>If <cite>action</cite> is a list of strings, by default it will be executed <strong>without the shell</strong> (Popen argument shell=False).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_python_version</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s">&#39;python&#39;</span><span class="p">,</span> <span class="s">&#39;--version&#39;</span><span class="p">]]</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>For complex commands it is also possible to pass a callable that returns
the command string. In this case you must explicit import CmdAction.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">doit.action</span> <span class="kn">import</span> <span class="n">CmdAction</span>

<span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello cmd &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">create_cmd_string</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;echo hi&quot;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">CmdAction</span><span class="p">(</span><span class="n">create_cmd_string</span><span class="p">)],</span>
        <span class="s">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>You might also explicitly import <tt class="docutils literal"><span class="pre">CmdAction</span></tt> in case you want to pass extra
parameters to <tt class="docutils literal"><span class="pre">Popen</span></tt> like <tt class="docutils literal"><span class="pre">cwd</span></tt>.
All keyword parameter from <tt class="docutils literal"><span class="pre">Popen</span></tt> can be used on <tt class="docutils literal"><span class="pre">CmdAction</span></tt> (except
<tt class="docutils literal"><span class="pre">stdout</span></tt> and <tt class="docutils literal"><span class="pre">stderr</span></tt>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Different from <cite>subprocess.Popen</cite>, <cite>CmdAction</cite> <cite>shell</cite> argument defaults to
<cite>True</cite>. All other <cite>Popen</cite> arguments can also be passed in <cite>CmdAction</cite> except
<cite>stdout</cite> and <cite>stderr</cite></p>
</div>
<p>The result of the task follows the shell convention.
If the process exits with the value <cite>0</cite> it is successful.
Any other value means the task failed.</p>
</div>
<div class="section" id="custom-actions">
<span id="id1"></span><h3>custom actions<a class="headerlink" href="#custom-actions" title="Permalink to this headline">¶</a></h3>
<p>It is possible to create other type of actions,
check <a class="reference internal" href="tools.html#tools-longrunning"><em>tools.LongRunning</em></a> as an example.</p>
</div>
</div>
<div class="section" id="task-name">
<h2>task name<a class="headerlink" href="#task-name" title="Permalink to this headline">¶</a></h2>
<p>By default a task name is taken from the name of the python function
that generates the task.
For example a <cite>def task_hello</cite> would create a task named <tt class="docutils literal"><span class="pre">hello</span></tt>.</p>
<p>It is possible to explicitly set a task name with the parameter <tt class="docutils literal"><span class="pre">basename</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hello&#39;</span><span class="p">]</span>
        <span class="p">}</span>

<span class="k">def</span> <span class="nf">task_xxx</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;basename&#39;</span><span class="p">:</span> <span class="s">&#39;hello2&#39;</span><span class="p">,</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hello2&#39;</span><span class="p">]</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  hello</span>
<span class="go">.  hello2</span>
</pre></div>
</div>
<p>When explicit using <tt class="docutils literal"><span class="pre">basename</span></tt> the task-creator is not limited
to create only one task.
Using <tt class="docutils literal"><span class="pre">yield</span></tt> it can generate several tasks at once.
It is also possible to <tt class="docutils literal"><span class="pre">yield</span></tt> a generator that generate tasks.
This is useful to write some generic/reusable task-creators.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">gen_many_tasks</span><span class="p">():</span>
    <span class="k">yield</span> <span class="p">{</span><span class="s">&#39;basename&#39;</span><span class="p">:</span> <span class="s">&#39;t1&#39;</span><span class="p">,</span>
           <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo t1&#39;</span><span class="p">]}</span>
    <span class="k">yield</span> <span class="p">{</span><span class="s">&#39;basename&#39;</span><span class="p">:</span> <span class="s">&#39;t2&#39;</span><span class="p">,</span>
           <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo t2&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_all</span><span class="p">():</span>
    <span class="k">yield</span> <span class="n">gen_many_tasks</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  t2</span>
<span class="go">.  t1</span>
</pre></div>
</div>
</div>
<div class="section" id="sub-tasks">
<h2>sub-tasks<a class="headerlink" href="#sub-tasks" title="Permalink to this headline">¶</a></h2>
<p>Most of the time we want to apply the same task several times
in different contexts.</p>
<p>The task function can return a python-generator that yields dictionaries.
Since each sub-task must be uniquely identified it requires an
additional field <tt class="docutils literal"><span class="pre">name</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_create_file</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;file</span><span class="si">%d</span><span class="s">.txt&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
               <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;touch </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  create_file:file0.txt</span>
<span class="go">.  create_file:file1.txt</span>
<span class="go">.  create_file:file2.txt</span>
</pre></div>
</div>
<div class="section" id="avoiding-empty-sub-tasks">
<h3>avoiding empty sub-tasks<a class="headerlink" href="#avoiding-empty-sub-tasks" title="Permalink to this headline">¶</a></h3>
<p>If you are not sure sub-tasks will be created for a given <tt class="docutils literal"><span class="pre">basename</span></tt>
but you want to make sure that a task exist,
you can yield a sub-task with <tt class="docutils literal"><span class="pre">name</span></tt> equal to <tt class="docutils literal"><span class="pre">None</span></tt>.
This can also used to set the task <tt class="docutils literal"><span class="pre">doc</span></tt> and <tt class="docutils literal"><span class="pre">watch</span></tt> attribute.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">glob</span>

<span class="k">def</span> <span class="nf">task_xxx</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;my doc&quot;&quot;&quot;</span>
    <span class="n">LIST</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.xyz&#39;</span><span class="p">)</span> <span class="c"># might be empty</span>
    <span class="k">yield</span> <span class="p">{</span>
        <span class="s">&#39;basename&#39;</span><span class="p">:</span> <span class="s">&#39;do_x&#39;</span><span class="p">,</span>
        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;doc&#39;</span><span class="p">:</span> <span class="s">&#39;docs for X&#39;</span><span class="p">,</span>
        <span class="s">&#39;watch&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">LIST</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s">&#39;basename&#39;</span><span class="p">:</span> <span class="s">&#39;do_x&#39;</span><span class="p">,</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span>
            <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="gp">$</span> doit list
<span class="go">do_x   docs for X</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dependencies-targets">
<h2>Dependencies &amp; Targets<a class="headerlink" href="#dependencies-targets" title="Permalink to this headline">¶</a></h2>
<p>One of the main ideas of <cite>doit</cite> (and other build-tools) is to check if the
tasks/targets are <strong>up-to-date</strong>. In case there is no modification in the
dependencies and the targets already exist, it skips the task execution to
save time, as it would produce the same output from the previous run.</p>
<dl class="docutils">
<dt>Dependency</dt>
<dd>A dependency indicates an input to the task execution.</dd>
<dt>Target</dt>
<dd>A <em>target</em> is the result/output file produced by the task execution.</dd>
</dl>
<p>i.e. In a compilation task the source file is a <em>file_dep</em>,
the object file is a <em>target</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_compile</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;cc -c main.c&quot;</span><span class="p">],</span>
            <span class="s">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;main.c&quot;</span><span class="p">,</span> <span class="s">&quot;defs.h&quot;</span><span class="p">],</span>
            <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;main.o&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<p><cite>doit</cite> automatically keeps track of file dependencies. It saves the
signature (MD5) of the dependencies every time the task is completed successfully.</p>
<p>So if there are no modifications to the dependencies and you run <cite>doit</cite> again.
The execution of the task&#8217;s actions is skipped.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  compile</span>
<span class="gp">$</span> doit
<span class="go">-- compile</span>
</pre></div>
</div>
<p>Note the <tt class="docutils literal"><span class="pre">--</span></tt> (2 dashes, one space) on the command output on the second
time it is executed. It means, this task was up-to-date and not executed.</p>
</div>
<div class="section" id="file-dep-file-dependency">
<h2>file_dep (file dependency)<a class="headerlink" href="#file-dep-file-dependency" title="Permalink to this headline">¶</a></h2>
<p>Different from most build-tools dependencies are on tasks, not on targets.
So <cite>doit</cite> can take advantage of the &#8220;execute only if not up-to-date&#8221; feature
even for tasks that don&#8217;t define targets.</p>
<p>Let&#8217;s say you work with a dynamic language (python in this example).
You don&#8217;t need to compile anything but you probably want to apply a lint-like
tool (i.e. <a class="reference external" href="http://pypi.python.org/pypi/pyflakes">pyflakes</a>) to your
source code files. You can define the source code as a dependency to the task.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_checker</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;pyflakes sample.py&quot;</span><span class="p">],</span>
            <span class="s">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;sample.py&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  checker</span>
<span class="gp">$</span> doit
<span class="go">-- checker</span>
</pre></div>
</div>
<p>Note the <tt class="docutils literal"><span class="pre">--</span></tt> again to indicate the execution was skipped.</p>
<p>Traditional build-tools can only handle files as &#8220;dependencies&#8221;.
<cite>doit</cite> has several ways to check for dependencies, those will be introduced later.</p>
</div>
<div class="section" id="targets">
<h2>targets<a class="headerlink" href="#targets" title="Permalink to this headline">¶</a></h2>
<p>Targets can be any file path (a file or folder). If a target doesn&#8217;t exist
the task will be executed. There is no limitation on the number of targets
a task may define. Two different tasks can not have the same target.</p>
<p>Lets take the compilation example again.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_compile</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;cc -c main.c&quot;</span><span class="p">],</span>
            <span class="s">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;main.c&quot;</span><span class="p">,</span> <span class="s">&quot;defs.h&quot;</span><span class="p">],</span>
            <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;main.o&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>If there are no changes in the dependency the task execution is skipped.</li>
<li>But if the target is removed the task is executed again.</li>
<li>But only if it does not exist. If the target is modified but the dependencies
do not change the task is not executed again.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  compile</span>
<span class="gp">$</span> doit
<span class="go">-- compile</span>
<span class="gp">$</span> rm main.o
<span class="gp">$</span> doit
<span class="go">.  compile</span>
<span class="gp">$</span> <span class="nb">echo </span>xxx &gt; main.o
<span class="gp">$</span> doit
<span class="go">-- compile</span>
</pre></div>
</div>
</div>
<div class="section" id="execution-order">
<h2>execution order<a class="headerlink" href="#execution-order" title="Permalink to this headline">¶</a></h2>
<p>If your tasks interact in a way where the target (output) of one task is a
file_dep (input) of another task, <cite>doit</cite> will make sure your tasks are
executed in the correct order.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_modify</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;echo bar &gt; foo.txt&quot;</span><span class="p">],</span>
            <span class="s">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;foo.txt&quot;</span><span class="p">],</span>
            <span class="p">}</span>

<span class="k">def</span> <span class="nf">task_create</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;touch foo.txt&quot;</span><span class="p">],</span>
            <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;foo.txt&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  create</span>
<span class="go">.  modify</span>
</pre></div>
</div>
</div>
<div class="section" id="task-selection">
<span id="id2"></span><h2>Task selection<a class="headerlink" href="#task-selection" title="Permalink to this headline">¶</a></h2>
<p>By default all tasks are executed in the same order as they were defined (the order may change to satisfy dependencies). You can control which tasks will run in 2 ways.</p>
<p>Another example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DOIT_CONFIG</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;default_tasks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;t3&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_t1</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;touch task1&quot;</span><span class="p">],</span>
            <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;task1&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_t2</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;echo task2&quot;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_t3</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;echo task3&quot;</span><span class="p">],</span>
            <span class="s">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;task1&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<div class="section" id="doit-config-default-tasks">
<h3>DOIT_CONFIG -&gt; default_tasks<a class="headerlink" href="#doit-config-default-tasks" title="Permalink to this headline">¶</a></h3>
<p><em>dodo</em> file defines a dictionary <tt class="docutils literal"><span class="pre">DOIT_CONFIG</span></tt> with <tt class="docutils literal"><span class="pre">default_tasks</span></tt>, a list of strings where each element is a task name.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  t1</span>
<span class="go">.  t3</span>
</pre></div>
</div>
<p>Note that only the task <em>t3</em> was specified to be executed by default.
But its dependencies include a target of another task (t1).
So that task was automatically executed also.</p>
</div>
<div class="section" id="command-line-selection">
<h3>command line selection<a class="headerlink" href="#command-line-selection" title="Permalink to this headline">¶</a></h3>
<p>From the command line you can control which tasks are going to be execute by passing its task name. Any number of tasks can be passed as positional arguments.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit t2
<span class="go">.  t2</span>
</pre></div>
</div>
<p>You can also specify which task to execute by its target:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit task1
<span class="go">.  t1</span>
</pre></div>
</div>
</div>
<div class="section" id="sub-task-selection">
<h3>sub-task selection<a class="headerlink" href="#sub-task-selection" title="Permalink to this headline">¶</a></h3>
<p>You can select sub-tasks from the command line specifying its full name.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_create_file</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;file</span><span class="si">%d</span><span class="s">.txt&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
               <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;touch </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit create_file:file2.txt
<span class="go">.  create_file:file2.txt</span>
</pre></div>
</div>
</div>
<div class="section" id="wildcard-selection">
<h3>wildcard selection<a class="headerlink" href="#wildcard-selection" title="Permalink to this headline">¶</a></h3>
<p>You can also select tasks to be executed using a <a class="reference external" href="http://docs.python.org/library/glob.html">glob</a> like syntax (it must contains a <tt class="docutils literal"><span class="pre">*</span></tt>).</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit create_file:file*
<span class="go">.  create_file:file1.txt</span>
<span class="go">.  create_file:file2.txt</span>
<span class="go">.  create_file:file3.txt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="arguments">
<span id="parameters"></span><h2>arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h2>
<p>It is possible to pass option parameters to the task through the command line.</p>
<p>Just add a <tt class="docutils literal"><span class="pre">params</span></tt> field to the task dictionary. <tt class="docutils literal"><span class="pre">params</span></tt> must be a list of
dictionaries where every entry is an option parameter. Each parameter must
define a name, and a default value. It can optionally define a &#8220;short&#8221; and
&#8220;long&#8221; names to be used from the command line (it follows unix command line
conventions). It may also specify additional attributes, such as
<cite>type</cite> and <cite>help</cite> (see <a class="reference internal" href="#parameters-attributes"><em>below</em></a>).</p>
<p>See the example:</p>
<div class="highlight-python"><div class="highlight"><pre>def task_py_params():
    def show_params(param1, param2):
        print param1
        print 5 + param2
    return {&#39;actions&#39;:[(show_params,)],
            &#39;params&#39;:[{&#39;name&#39;:&#39;param1&#39;,
                       &#39;short&#39;:&#39;p&#39;,
                       &#39;default&#39;:&#39;default value&#39;},

                      {&#39;name&#39;:&#39;param2&#39;,
                       &#39;long&#39;:&#39;param2&#39;,
                       &#39;type&#39;: int,
                       &#39;default&#39;:0}],
            &#39;verbosity&#39;:2,
            }

def task_cmd_params():
    return {&#39;actions&#39;:[&quot;echo mycmd %(flag)s xxx&quot;],
            &#39;params&#39;:[{&#39;name&#39;:&#39;flag&#39;,
                       &#39;short&#39;:&#39;f&#39;,
                       &#39;long&#39;: &#39;flag&#39;,
                       &#39;default&#39;: &#39;&#39;,
                       &#39;help&#39;: &#39;helpful message about this flag&#39;}],
            &#39;verbosity&#39;: 2
            }
</pre></div>
</div>
<p>For python-actions the python function must define arguments with the same name as a task parameter.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit py_params -p abc --param2 4
<span class="go">.  py_params</span>
<span class="go">abc</span>
<span class="go">9</span>
</pre></div>
</div>
<p>For cmd-actions use python string substitution notation:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit cmd_params -f <span class="s2">&quot;-c --other value&quot;</span>
<span class="go">.  cmd_params</span>
<span class="go">mycmd -c --other value xxx</span>
</pre></div>
</div>
<div class="section" id="all-parameters-attributes">
<span id="parameters-attributes"></span><h3>All parameters attributes<a class="headerlink" href="#all-parameters-attributes" title="Permalink to this headline">¶</a></h3>
<p>Here is the list of all attributes <tt class="docutils literal"><span class="pre">param</span></tt> accepts:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd><p class="first">Name of the parameter, identifier used as name of the the parameter
on python code.
It should be unique among others.</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">True</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><cite>str</cite></td>
</tr>
</tbody>
</table>
</dd>
<dt><tt class="docutils literal"><span class="pre">default</span></tt></dt>
<dd><p class="first">Default value used when it is set through command-line.</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">True</td>
</tr>
</tbody>
</table>
</dd>
<dt><tt class="docutils literal"><span class="pre">short</span></tt></dt>
<dd><p class="first">Short parameter form, used for e.g. <tt class="docutils literal"><span class="pre">-p</span> <span class="pre">value</span></tt>.</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">optional</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><cite>str</cite></td>
</tr>
</tbody>
</table>
</dd>
<dt><tt class="docutils literal"><span class="pre">long</span></tt></dt>
<dd><p class="first">Long parameter form, used for e.g. <tt class="docutils literal"><span class="pre">--parameter</span> <span class="pre">value</span></tt>
when it differs from its <cite>name</cite>.</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">optional</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><cite>str</cite></td>
</tr>
</tbody>
</table>
</dd>
<dt><tt class="docutils literal"><span class="pre">type</span></tt></dt>
<dd><p class="first">Actually it can be any python callable.
It coverts the string value received from command line to whatever
value to be used on python code.</p>
<p>If the <tt class="docutils literal"><span class="pre">type</span></tt> is <tt class="docutils literal"><span class="pre">bool</span></tt> the parameter is treated as an <em>option flag</em>
where no value should be specified, value is set to <tt class="docutils literal"><span class="pre">True</span></tt>.
Example: <tt class="docutils literal"><span class="pre">doit</span> <span class="pre">mytask</span> <span class="pre">--flag</span></tt>.</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">optional</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><cite>callable</cite> (e.g. a <cite>function</cite>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">default:</th><td class="field-body"><cite>str</cite></td>
</tr>
</tbody>
</table>
</dd>
<dt><tt class="docutils literal"><span class="pre">help</span></tt></dt>
<dd><p class="first">Help message associated to this parameter, shown when
<a class="reference internal" href="cmd_other.html#cmd-help"><em>help</em></a> is called for this task,
e.g. <tt class="docutils literal"><span class="pre">doit</span> <span class="pre">help</span> <span class="pre">mytask</span></tt>.</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">optional</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><cite>str</cite></td>
</tr>
</tbody>
</table>
</dd>
<dt><tt class="docutils literal"><span class="pre">inverse</span></tt></dt>
<dd><p class="first">[only for <cite>bool</cite> parameter]
Set inverse flag long parameter name, value will be set to <tt class="docutils literal"><span class="pre">False</span></tt>
(see example below).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">required:</th><td class="field-body">optional</td>
</tr>
<tr class="field-even field"><th class="field-name">type:</th><td class="field-body"><cite>str</cite></td>
</tr>
</tbody>
</table>
<p>Example, given following code:</p>
<div class="highlight-python"><div class="highlight"><pre>def task_with_flag():
    def _task(flag):
        print &quot;Flag {0}&quot;.format(&quot;On&quot; if flag else &quot;Off&quot;)

    return {
        &#39;params&#39;: [{
            &#39;name&#39;: &#39;flag&#39;,
            &#39;long&#39;: &#39;flagon&#39;,
            &#39;short&#39;: &#39;f&#39;,
            &#39;type&#39;: bool,
            &#39;default&#39;: True,
            &#39;inverse&#39;: &#39;flagoff&#39;}],
        &#39;actions&#39;: [(_task, )],
        &#39;verbosity&#39;: 2
        }
</pre></div>
</div>
<p>calls to task <cite>with_flag</cite> show flag on or off:</p>
<div class="last highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit with_flag
<span class="go">.  with_flag</span>
<span class="go">Flag On</span>
<span class="gp">$</span> doit with_flag --flagoff
<span class="go">.  with_flag</span>
<span class="go">Flag Off</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="positional-arguments">
<h2>positional arguments<a class="headerlink" href="#positional-arguments" title="Permalink to this headline">¶</a></h2>
<p>Tasks might also get positional arguments from the command line
as standard unix commands do,
with positional arguments <em>after</em> optional arguments.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_pos_args</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">show_params</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;param1 is: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">pos_arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;positional-{0}: {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pos_arg</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:[(</span><span class="n">show_params</span><span class="p">,)],</span>
            <span class="s">&#39;params&#39;</span><span class="p">:[{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;param1&#39;</span><span class="p">,</span>
                       <span class="s">&#39;short&#39;</span><span class="p">:</span><span class="s">&#39;p&#39;</span><span class="p">,</span>
                       <span class="s">&#39;default&#39;</span><span class="p">:</span><span class="s">&#39;default value&#39;</span><span class="p">},</span>
                      <span class="p">],</span>
            <span class="s">&#39;pos_arg&#39;</span><span class="p">:</span> <span class="s">&#39;pos&#39;</span><span class="p">,</span>
            <span class="s">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit pos_args -p 4 foo bar
<span class="go">.  pos_args</span>
<span class="go">param1 is: 4</span>
<span class="go">positional-0: foo</span>
<span class="go">positional-1: bar</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If a task accepts positional arguments, it is not allowed to pass
other tasks after it in the command line. For example if <cite>task1</cite>
takes positional arguments you can not call:</p>
<div class="highlight-python"><div class="highlight"><pre>$ doit task1 pos1 task2
</pre></div>
</div>
<p class="last">As the string <cite>task2</cite> would be interpreted as positional argument from
<cite>task1</cite> not as another task name.</p>
</div>
</div>
<div class="section" id="command-line-variables-doit-get-var">
<span id="command-line-variables"></span><h2>command line variables (<em>doit.get_var</em>)<a class="headerlink" href="#command-line-variables-doit-get-var" title="Permalink to this headline">¶</a></h2>
<p>It is possible to pass variable values to be used in dodo.py from the command line.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">doit</span> <span class="kn">import</span> <span class="n">get_var</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;abc&quot;</span><span class="p">:</span> <span class="n">get_var</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;NO&#39;</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">task_echo</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hi </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">config</span><span class="p">],</span>
            <span class="s">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  echo</span>
<span class="go">hi {abc: NO}</span>
<span class="gp">$</span> doit <span class="nv">abc</span><span class="o">=</span>xyz <span class="nv">x</span><span class="o">=</span>3
<span class="go">.  echo</span>
<span class="go">hi {abc: xyz}</span>
</pre></div>
</div>
</div>
<div class="section" id="private-hidden-tasks">
<h2>private/hidden tasks<a class="headerlink" href="#private-hidden-tasks" title="Permalink to this headline">¶</a></h2>
<p>If task name starts with an underscore &#8216;_&#8217;, it will not be included in the output.</p>
</div>
<div class="section" id="title">
<h2>title<a class="headerlink" href="#title" title="Permalink to this headline">¶</a></h2>
<p>By default when you run <cite>doit</cite> only the task name is printed out on the output.
You can customize the output passing a &#8220;title&#8221; function to the task:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">show_cmd</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;executing... </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span>

<span class="k">def</span> <span class="nf">task_custom_display</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:[</span><span class="s">&#39;echo abc efg&#39;</span><span class="p">],</span>
            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">show_cmd</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  executing... Cmd: echo abc efg</span>
</pre></div>
</div>
</div>
<div class="section" id="verbosity">
<span id="id3"></span><h2>verbosity<a class="headerlink" href="#verbosity" title="Permalink to this headline">¶</a></h2>
<p>By default the stdout from a task is captured and its stderr is sent to the
console. If the task fails or there is an error the stdout and a traceback
(if any) is displayed.</p>
<p>There are 3 levels of verbosity:</p>
<dl class="docutils">
<dt>0:</dt>
<dd>capture (do not print) stdout/stderr from task.</dd>
<dt>1 (default):</dt>
<dd>capture stdout only.</dd>
<dt>2:</dt>
<dd>do not capture anything (print everything immediately).</dd>
</dl>
<p>You can control the verbosity by:</p>
<ul class="simple">
<li>task attribute verbosity</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task_print</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hello&#39;</span><span class="p">],</span>
            <span class="s">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit
<span class="go">.  print</span>
<span class="go">hello</span>
</pre></div>
</div>
<ul class="simple">
<li>from command line, see <a class="reference internal" href="cmd_run.html#verbosity-option"><em>verbosity option</em></a>.</li>
</ul>
</div>
<div class="section" id="custom-task-definition">
<span id="create-doit-tasks"></span><h2>custom task definition<a class="headerlink" href="#custom-task-definition" title="Permalink to this headline">¶</a></h2>
<p>Apart from collect functions that start with the name <cite>task_</cite>.
The <em>doit</em> loader will also execute the <tt class="docutils literal"><span class="pre">create_doit_tasks</span></tt>
callable from any object that contains this attribute.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">make_task</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;make decorated function a task-creator&quot;&quot;&quot;</span>
    <span class="n">func</span><span class="o">.</span><span class="n">create_doit_tasks</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">func</span>

<span class="nd">@make_task</span>
<span class="k">def</span> <span class="nf">sample</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hi&#39;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://bitbucket.org/takluyver/letsdoit">project letsdoit</a>
has some real-world implementations.</p>
<p>For simple examples to help you create your own check this
<a class="reference external" href="http://blog.schettino72.net/posts/doit-task-creation.html">blog post</a>.</p>
</div>
<div class="section" id="importing-tasks">
<h2>importing tasks<a class="headerlink" href="#importing-tasks" title="Permalink to this headline">¶</a></h2>
<p>The <em>doit</em> loader will look at <strong>all</strong> objects in the namespace of the <em>dodo</em>.
It will look for functions staring with <tt class="docutils literal"><span class="pre">task_</span></tt> and objects with
<tt class="docutils literal"><span class="pre">create_doit_tasks</span></tt>.
So it is also possible to load task definitions from other
modules just by importing them into your <em>dodo</em> file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># import task_ functions</span>
<span class="kn">from</span> <span class="nn">get_var</span> <span class="kn">import</span> <span class="n">task_echo</span>

<span class="c"># import tasks with create_doit_tasks callable</span>
<span class="kn">from</span> <span class="nn">custom_task_def</span> <span class="kn">import</span> <span class="n">sample</span>


<span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hello&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit list
<span class="go">echo</span>
<span class="go">hello</span>
<span class="go">sample</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Importing tasks from different modules is useful if you want to split
your task definitions in different modules.</p>
<p class="last">The best way to create re-usable tasks that can be used in several projects
is to call functions that return task dict&#8217;s.
For example take a look at a reusable <em>pyflakes</em>
<a class="reference external" href="https://github.com/pydoit/doit-py/blob/master/doitpy/pyflakes.py">task generator</a>.
Check the project <a class="reference external" href="https://github.com/pydoit/doit-py">doit-py</a>
for more examples.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="dependencies.html" title="More on dependencies"
             >next</a></li>
        <li class="right" >
          <a href="install.html" title="Installing"
             >previous</a> |</li>
  <li><a href="index.html">Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&nbsp;|&nbsp;</li>
  <!-- TODO news -->
  <li><a class="external-link" href="https://github.com/pydoit/doit">Code</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="https://github.com/pydoit/doit/issues">Issues</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://pypi.python.org/pypi/doit">Download</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://groups.google.co.in/group/python-doit">Forum</a></li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Eduardo Schettino.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>