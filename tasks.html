<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="pydoit guide - core concepts: tasks, actions, dependencies and targets." name="description" />
<meta content="python, doit, documentation, guide, introduction, task, actions, dependencies, targets, cmd action" name="keywords" />

      <title>Introduction to Tasks, basic metadata and operations</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
      <link rel="canonical" href="https://pydoit.org/tasks.html" />
    
      <link rel="shortcut icon" href="_static/favico.ico"/>
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="Non-file dependencies" href="dependencies.html" />
  <link rel="prev" title="Installing" href="install.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="contents.html" class="home-link">
    
      <img class="logo" src="_static/doit-logo-small.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="contents.html#getting-started"
         class="nav-link ">
         getting started
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#guide"
         class="nav-link  router-link-active">
         guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#project"
         class="nav-link ">
         project
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://twitter.com/pydoit"
        class="nav-link external">
          Twitter <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/pydoit/doit"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="contents.html#getting-started"
         class="nav-link ">
         getting started
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#guide"
         class="nav-link  router-link-active">
         guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="contents.html#project"
         class="nav-link ">
         project
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://twitter.com/pydoit"
        class="nav-link external">
          Twitter <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/pydoit/doit"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="contents.html#getting-started">getting started</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="usecases.html" class="reference internal ">Use Cases</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tutorial-1.html" class="reference internal ">tutorial - python imports graph</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="contents.html#guide">guide</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="install.html" class="reference internal ">Installing</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Tasks</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#intro" class="reference internal">Intro</a></li>
                
                  <li class="toctree-l2"><a href="#actions" class="reference internal">Actions</a></li>
                
                  <li class="toctree-l2"><a href="#task-name" class="reference internal">task name</a></li>
                
                  <li class="toctree-l2"><a href="#listing-tasks" class="reference internal">listing tasks</a></li>
                
                  <li class="toctree-l2"><a href="#doc" class="reference internal">doc</a></li>
                
                  <li class="toctree-l2"><a href="#sub-tasks" class="reference internal">sub-tasks</a></li>
                
                  <li class="toctree-l2"><a href="#dependencies-targets" class="reference internal">Dependencies & Targets</a></li>
                
                  <li class="toctree-l2"><a href="#file-dep-file-dependency" class="reference internal">file_dep (file dependency)</a></li>
                
                  <li class="toctree-l2"><a href="#targets" class="reference internal">targets</a></li>
                
                  <li class="toctree-l2"><a href="#execution-order" class="reference internal">execution order</a></li>
                
                  <li class="toctree-l2"><a href="#task-selection" class="reference internal">Task selection</a></li>
                
                  <li class="toctree-l2"><a href="#parameters-on-actions" class="reference internal">parameters on actions</a></li>
                
                  <li class="toctree-l2"><a href="#private-hidden-tasks" class="reference internal">private/hidden tasks</a></li>
                
                  <li class="toctree-l2"><a href="#title" class="reference internal">title</a></li>
                
                  <li class="toctree-l2"><a href="#verbosity" class="reference internal">verbosity</a></li>
                
                  <li class="toctree-l2"><a href="#meta" class="reference internal">meta</a></li>
                
                  <li class="toctree-l2"><a href="#id7" class="reference internal">pathlib</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="dependencies.html" class="reference internal ">Non-file dependencies</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="task-creation.html" class="reference internal ">More on Task creation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd-run.html" class="reference internal ">Command line interface - run</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cmd-other.html" class="reference internal ">sub-commands for task manipulation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="configuration.html" class="reference internal ">Configuration</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="task-args.html" class="reference internal ">Passing arguments from the command line</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="globals.html" class="reference internal ">Globals - accessing doit internals</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="uptodate.html" class="reference internal ">custom up-to-date</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tools.html" class="reference internal ">Tools & Integrations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="extending.html" class="reference internal ">Extending doit</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="contents.html#project">project</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="support.html" class="reference internal ">Support</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="changes.html" class="reference internal ">Changes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="stories.html" class="reference internal ">Success Stories</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="faq.html" class="reference internal ">FAQ</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="related.html" class="reference internal ">Related Projects</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>

  
    <div style="margin-bottom: 0px; padding:1rem; background-color: #2980B9; color:#fcfcfc;">
      <h3>Donate</h3>
      <p>If you find <em>doit</em> useful, please consider supporting the maintainer with a donation.</p>
      <p><em>doit</em> is 100% open-source and maintained by individuals without any company backing it... Your donation keeps the project healthy and maintained.</p>
    </div>

    <div style="text-align:center; padding:1rem; color:black;background-color:#fcfcfc; margin-bottom:2rem;">
      <h4 style="margin-bottom:5px;margin-top:5px;">OpenCollective</h4>
      <div>
        <object type="image/svg+xml" data="https://opencollective.com/doit/tiers/backers.svg?avatarHeight=60&width=200"></object>
      </div>

      <hr style="margin-top:5px;">
      <h4 style="margin-bottom:20px;">Paypal</h4>
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" style="margin:auto;">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="hosted_button_id" value="GFU3BPVN586A6">
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" border="0" src="https://www.paypalobjects.com/pt_BR/i/scr/pixel.gif" width="1" height="1" style="visibility:hidden;">
      </form>
    </div>
    <br>
  

        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="contents.html">Docs</a> &raquo;</li>
    
    <li>Introduction to Tasks, basic metadata and operations</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="install.html"
       title="previous chapter">← Installing</a>
  </li>
  <li class="next">
    <a href="dependencies.html"
       title="next chapter">Non-file dependencies →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h1>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p><cite>doit</cite> is all about automating task dependency management and execution.
Tasks can execute external shell commands/scripts or python functions
(actually any callable).
So a task can be anything you can code :)</p>
<p>Tasks are defined in plain <a class="reference external" href="http://python.org/">python</a> module with some
conventions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should be comfortable with python basics. If you don’t know python yet
check <a class="reference external" href="http://docs.python.org/tut/">Python tutorial</a>.</p>
</div>
<p>A function that starts with the name <cite>task_</cite> defines a <em>task-creator</em> recognized
by <cite>doit</cite>.
These functions must return (or yield) dictionaries representing a <em>task</em>.
A python module/file that defines <em>tasks</em> for <cite>doit</cite> is called <strong>dodo</strong> file
(that is something like a <cite>Makefile</cite> for <cite>make</cite>).</p>
<p>Take a look at this example (file dodo.py):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">python_hello</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Python says Hello World!!!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">python_hello</span><span class="p">],</span>
        <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hello.txt&quot;</span><span class="p">],</span>
        <span class="p">}</span>

</pre></div>
</div>
<p>When <cite>doit</cite> is executed without any parameters it will look for tasks in a
file named <cite>dodo.py</cite> in the current folder and execute its tasks.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  hello</span>
</pre></div>
</div>
<p>On the output it displays which tasks were executed.
In this case the <cite>dodo</cite> file has only one task, <cite>hello</cite>.</p>
</section>
<section id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>Every <em>task</em> must define <cite>actions</cite>.
It can optionally define other attributes like <cite>targets</cite>, <cite>file_dep</cite>,
<cite>verbosity</cite>, <cite>doc</cite> …</p>
<p><cite>actions</cite> define what the task actually does.
<cite>actions</cite> is always a list that can have any number of elements.
The actions of a task are always run sequentially.
There are 2 basic kinds of <cite>actions</cite>: <em>cmd-action</em> and <em>python-action</em>.
The action “result” is used to determine if task execution was successful or not.</p>
<section id="python-action">
<h3>python-action<a class="headerlink" href="#python-action" title="Permalink to this headline">¶</a></h3>
<p>If <cite>action</cite> is a python callable or a tuple <cite>(callable, *args, **kwargs)</cite>
- only <cite>callable</cite> is required.
The callable must be a function, method or callable object.
Classes and built-in functions are not allowed.
<code class="docutils literal notranslate"><span class="pre">args</span></code> is a sequence and <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> is a dictionary that will be used
as positional and keywords arguments for the callable.
See <a class="reference external" href="http://docs.python.org/tutorial/controlflow.html#keyword-arguments">Keyword Arguments</a>.</p>
<p>The result of the task is given by the returned value of the
<code class="docutils literal notranslate"><span class="pre">action</span></code> function.</p>
<p>For <strong>successful</strong> completion it must return one of:</p>
<ul class="simple">
<li><p><cite>True</cite></p></li>
<li><p><cite>None</cite></p></li>
<li><p>a dictionary</p></li>
<li><p>a string</p></li>
</ul>
<p>For <strong>unsuccessful</strong> completion it must return one of:</p>
<ul class="simple">
<li><p><cite>False</cite> indicates the task generally failed</p></li>
<li><p>if it raises any exception, it will be considered an error</p></li>
<li><p>it can also explicitly return an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">TaskFailed</span></code>
or <code class="xref py py-class docutils literal notranslate"><span class="pre">TaskError</span></code></p></li>
</ul>
<p>If the action returns a type other than the types already discussed, the action
will be considered a failure, although this behavior might change in future
versions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello py &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">python_hello</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">times</span> <span class="o">*</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">python_hello</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;py!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">])],</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hello.txt&quot;</span><span class="p">],</span>
            <span class="p">}</span>
</pre></div>
</div>
<p>The function <cite>task_hello</cite> is a <em>task-creator</em>, not the task itself.
The body of the task-creator function is always executed when the dodo
file is loaded.</p>
<div class="topic">
<p class="topic-title">task-creators vs actions</p>
<p>The body of task-creators are executed even if the task is not going
to be executed.
The body of task-creators should be used to create task metadata only,
not execute tasks!
From now on when the  documentation says that a <em>task</em> is executed,
read “the task’s actions are executed”.</p>
</div>
<p><cite>action</cite> parameters can be passed as <code class="docutils literal notranslate"><span class="pre">kwargs</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func_with_args</span><span class="p">(</span><span class="n">arg_first</span><span class="p">,</span> <span class="n">arg_second</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">arg_first</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">arg_second</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">task_call_func</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">func_with_args</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span>
            <span class="s1">&#39;arg_second&#39;</span><span class="p">:</span> <span class="s1">&#39;This is a second argument.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arg_first&#39;</span><span class="p">:</span> <span class="s1">&#39;This is a first argument.&#39;</span><span class="p">})</span>
        <span class="p">],</span>
        <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="cmd-action">
<h3>cmd-action<a class="headerlink" href="#cmd-action" title="Permalink to this headline">¶</a></h3>
<p>CmdAction’s are executed in a subprocess (using python
<a class="reference external" href="http://docs.python.org/library/subprocess.html#popen-constructor">subprocess.Popen</a>).</p>
<p>If <cite>action</cite> is a string, the command will be executed through the shell.
(Popen argument shell=True).</p>
<p>It is easy to include dynamic (on-the-fly) behavior to your tasks with
python code from the <cite>dodo</cite> file. Let’s take a look at another example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello cmd &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="s2">&quot;hi! &quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">],</span>
        <span class="p">}</span>

</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The body of the <em>task-creator</em> is always executed,
so in this example the line <cite>msg = 3 * “hi! “</cite> will always be executed.</p>
</div>
<p>If <cite>action</cite> is a list of strings and instances of any Path class from
<a class="reference external" href="https://docs.python.org/3/library/pathlib.html">pathlib</a>, by default it will
be executed <strong>without the shell</strong> (Popen argument shell=False).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_python_version</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">]]</span>
        <span class="p">}</span>

</pre></div>
</div>
<p>For complex commands it is also possible to pass a callable that returns
the command string. In this case you must explicit import CmdAction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">doit.action</span> <span class="kn">import</span> <span class="n">CmdAction</span>

<span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello cmd &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">create_cmd_string</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;echo hi&quot;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">CmdAction</span><span class="p">(</span><span class="n">create_cmd_string</span><span class="p">)],</span>
        <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>You might also explicitly import <code class="docutils literal notranslate"><span class="pre">CmdAction</span></code> in case you want to pass extra
parameters to <code class="docutils literal notranslate"><span class="pre">Popen</span></code> like <code class="docutils literal notranslate"><span class="pre">cwd</span></code>.
All keyword parameter from <code class="docutils literal notranslate"><span class="pre">Popen</span></code> can be used on <code class="docutils literal notranslate"><span class="pre">CmdAction</span></code> (except
<code class="docutils literal notranslate"><span class="pre">stdout</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Different from <cite>subprocess.Popen</cite>, <cite>CmdAction</cite> <cite>shell</cite> argument defaults to
<cite>True</cite>. All other <cite>Popen</cite> arguments can also be passed in <cite>CmdAction</cite> except
<cite>stdout</cite> and <cite>stderr</cite></p>
</div>
<p>The result of the task follows the shell convention.
If the process exits with the value <cite>0</cite> it is successful.
Any other value means the task failed.</p>
</section>
<section id="custom-actions">
<span id="id1"></span><h3>custom actions<a class="headerlink" href="#custom-actions" title="Permalink to this headline">¶</a></h3>
<p>It is possible to create other type of actions,
check <a class="reference internal" href="tools.html#tools-longrunning"><span class="std std-ref">tools.LongRunning</span></a> as an example.</p>
</section>
</section>
<section id="task-name">
<h2>task name<a class="headerlink" href="#task-name" title="Permalink to this headline">¶</a></h2>
<p>By default a task name is taken from the name of the python function
that generates the task.
For example a <cite>def task_hello</cite> would create a task named <code class="docutils literal notranslate"><span class="pre">hello</span></code>.</p>
<p>It is possible to explicitly set a task name with the parameter <code class="docutils literal notranslate"><span class="pre">basename</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;say hello&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo hello&#39;</span><span class="p">]</span>
        <span class="p">}</span>

<span class="k">def</span> <span class="nf">task_xxx</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;say hello again&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;basename&#39;</span><span class="p">:</span> <span class="s1">&#39;hello2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo hello2&#39;</span><span class="p">]</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  hello</span>
<span class="go">.  hello2</span>
</pre></div>
</div>
<p>When explicit using <code class="docutils literal notranslate"><span class="pre">basename</span></code> the task-creator is not limited
to create only one task.
Using <code class="docutils literal notranslate"><span class="pre">yield</span></code> it can generate several tasks at once.
It is also possible to <code class="docutils literal notranslate"><span class="pre">yield</span></code> a generator that generate tasks.
This is useful to write some generic/reusable task-creators.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span> <span class="nf">gen_many_tasks</span><span class="p">():</span>
    <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;basename&#39;</span><span class="p">:</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span>
           <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo t1&#39;</span><span class="p">]}</span>
    <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;basename&#39;</span><span class="p">:</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span>
           <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo t2&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_all</span><span class="p">():</span>
    <span class="k">yield</span> <span class="n">gen_many_tasks</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  t2</span>
<span class="go">.  t1</span>
</pre></div>
</div>
</section>
<section id="listing-tasks">
<h2>listing tasks<a class="headerlink" href="#listing-tasks" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">doit</span></code> has built-in sub-command that can be used to list/print all tasks.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit list
<span class="go">hello    say hello</span>
<span class="go">hello2   say hello again</span>
</pre></div>
</div>
</section>
<section id="doc">
<h2>doc<a class="headerlink" href="#doc" title="Permalink to this headline">¶</a></h2>
<p>Every task has an associated documentation.
By default this documentation is taken from the task-creator function’s docstring.
It can also be set by the <code class="docutils literal notranslate"><span class="pre">doc</span></code> attribute.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo hello&#39;</span><span class="p">],</span>
        <span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="s1">&#39;say hello&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit list
<span class="go">.  hello  say hello</span>
</pre></div>
</div>
</section>
<section id="sub-tasks">
<h2>sub-tasks<a class="headerlink" href="#sub-tasks" title="Permalink to this headline">¶</a></h2>
<p>Most of the time we want to apply the same task several times
in different contexts.</p>
<p>The task function can return a python-generator that yields dictionaries.
Since each sub-task must be uniquely identified it requires an
additional field <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_create_file</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;file</span><span class="si">%d</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
               <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;touch </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  create_file:file0.txt</span>
<span class="go">.  create_file:file1.txt</span>
<span class="go">.  create_file:file2.txt</span>
</pre></div>
</div>
<section id="avoiding-empty-sub-tasks">
<h3>avoiding empty sub-tasks<a class="headerlink" href="#avoiding-empty-sub-tasks" title="Permalink to this headline">¶</a></h3>
<p>If you are not sure sub-tasks will be created for a given <code class="docutils literal notranslate"><span class="pre">basename</span></code>
but you want to make sure that a task exists,
you can yield a sub-task with <code class="docutils literal notranslate"><span class="pre">name</span></code> equal to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
This can also be used to set the task <code class="docutils literal notranslate"><span class="pre">doc</span></code> and <code class="docutils literal notranslate"><span class="pre">watch</span></code> attributes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>

<span class="k">def</span> <span class="nf">task_xxx</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;my doc&quot;&quot;&quot;</span>
    <span class="n">LIST</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.xyz&#39;</span><span class="p">)</span> <span class="c1"># might be empty</span>
    <span class="k">yield</span> <span class="p">{</span>
        <span class="s1">&#39;basename&#39;</span><span class="p">:</span> <span class="s1">&#39;do_x&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="s1">&#39;docs for X&#39;</span><span class="p">,</span>
        <span class="s1">&#39;watch&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">LIST</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s1">&#39;basename&#39;</span><span class="p">:</span> <span class="s1">&#39;do_x&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span>
            <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">],</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="gp">$ </span>doit list
<span class="go">do_x   docs for X</span>
</pre></div>
</div>
</section>
</section>
<section id="dependencies-targets">
<h2>Dependencies &amp; Targets<a class="headerlink" href="#dependencies-targets" title="Permalink to this headline">¶</a></h2>
<p>One of the main ideas of <cite>doit</cite> (and other build-tools) is to check if the
tasks/targets are <strong>up-to-date</strong>. In case there is no modification in the
dependencies and the targets already exist, it skips the task execution to
save time, as it would produce the same output from the previous run.</p>
<dl class="simple">
<dt>Dependency</dt><dd><p>A dependency indicates an input to the task execution.</p>
</dd>
<dt>Target</dt><dd><p>A <em>target</em> is the result/output file produced by the task execution.</p>
</dd>
</dl>
<p>i.e. In a compilation task the source file is a <em>file_dep</em>,
the object file is a <em>target</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_compile</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cc -c main.c&quot;</span><span class="p">],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;main.c&quot;</span><span class="p">,</span> <span class="s2">&quot;defs.h&quot;</span><span class="p">],</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;main.o&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<p><cite>doit</cite> automatically keeps track of file dependencies. It saves the
signature (MD5) of the dependencies every time the task is completed successfully.</p>
<p>So if there are no modifications to the dependencies and you run <cite>doit</cite> again.
The execution of the task’s actions is skipped.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  compile</span>
<span class="gp">$ </span>doit
<span class="go">-- compile</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">--</span></code> (2 dashes, one space) on the command output on the second
time it is executed. It means, this task was up-to-date and not executed.</p>
</section>
<section id="file-dep-file-dependency">
<span id="file-dep"></span><h2>file_dep (file dependency)<a class="headerlink" href="#file-dep-file-dependency" title="Permalink to this headline">¶</a></h2>
<p>Different from most build-tools dependencies are on tasks, not on targets.
So <cite>doit</cite> can take advantage of the “execute only if not up-to-date” feature
even for tasks that don’t define targets.</p>
<p>Let’s say you work with a dynamic language (python in this example).
You don’t need to compile anything but you probably want to apply a lint-like
tool (i.e. <a class="reference external" href="http://pypi.python.org/pypi/pyflakes">pyflakes</a>) to your
source code files. You can define the source code as a dependency to the task.</p>
<p>Every dependency in file_dep list should be a string or an instance of any
Path class from <a class="reference external" href="https://docs.python.org/3/library/pathlib.html">pathlib</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_checker</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pyflakes sample.py&quot;</span><span class="p">],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sample.py&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  checker</span>
<span class="gp">$ </span>doit
<span class="go">-- checker</span>
</pre></div>
</div>
<p><cite>doit</cite> checks if <cite>file_dep</cite> was modified or not
(by comparing the file content’s MD5). If there are no changes the action
is not executed again as it would produce the same result.</p>
<p>Note the <code class="docutils literal notranslate"><span class="pre">--</span></code> again to indicate the execution was skipped.</p>
<p>Traditional build-tools can only handle files as “dependencies”.
<cite>doit</cite> has several ways to check for dependencies, those will be introduced later.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>doit</cite> saves the MD5 of a <cite>file_dep</cite> after the actions are executed.
Be careful about editing a <cite>file_dep</cite> while a task is running because
<cite>doit</cite> might save the MD5 of a version of the file that is different
than it actually used to execute the task.</p>
</div>
</section>
<section id="targets">
<h2>targets<a class="headerlink" href="#targets" title="Permalink to this headline">¶</a></h2>
<p>Targets can be any file path (a file or folder). If a target does not exist
the task will be executed. There is no limitation on the number of targets
a task may define. Two different tasks can not have the same target. Target
can be specified as a string or as an instance of any Path class from
<a class="reference external" href="https://docs.python.org/3/library/pathlib.html">pathlib</a>.</p>
<p>Lets take the compilation example again.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_compile</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cc -c main.c&quot;</span><span class="p">],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;main.c&quot;</span><span class="p">,</span> <span class="s2">&quot;defs.h&quot;</span><span class="p">],</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;main.o&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>If there are no changes in the dependency the task execution is skipped.</p></li>
<li><p>But if the target is removed the task is executed again.</p></li>
<li><p>But only if it does not exist. If the target is modified but the dependencies
do not change the task is not executed again.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  compile</span>
<span class="gp">$ </span>doit
<span class="go">-- compile</span>
<span class="gp">$ </span>rm main.o
<span class="gp">$ </span>doit
<span class="go">.  compile</span>
<span class="gp">$ </span><span class="nb">echo</span> xxx &gt; main.o
<span class="gp">$ </span>doit
<span class="go">-- compile</span>
</pre></div>
</div>
</section>
<section id="execution-order">
<h2>execution order<a class="headerlink" href="#execution-order" title="Permalink to this headline">¶</a></h2>
<p>If your tasks interact in a way where the target (output) of one task is a
file_dep (input) of another task, <cite>doit</cite> will make sure your tasks are
executed in the correct order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_modify</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;echo bar &gt; foo.txt&quot;</span><span class="p">],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo.txt&quot;</span><span class="p">],</span>
            <span class="p">}</span>

<span class="k">def</span> <span class="nf">task_create</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;touch foo.txt&quot;</span><span class="p">],</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo.txt&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  create</span>
<span class="go">.  modify</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>doit</cite> compares the path (string) of the file of <cite>file_dep</cite> and <cite>targets</cite>.
So although <cite>my_file</cite> and <cite>./my_file</cite> are actually the same file, <cite>doit</cite>
will think they are different files.</p>
</div>
</section>
<section id="task-selection">
<span id="id4"></span><h2>Task selection<a class="headerlink" href="#task-selection" title="Permalink to this headline">¶</a></h2>
<p>By default all tasks are executed in the same order as they were defined (the order may change to satisfy dependencies). You can control which tasks will run in 2 ways.</p>
<p>Another example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">DOIT_CONFIG</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;default_tasks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_t1</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;touch task1&quot;</span><span class="p">],</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;task1&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_t2</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;echo task2&quot;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">task_t3</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;echo task3&quot;</span><span class="p">],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;task1&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<section id="doit-config-default-tasks">
<h3>DOIT_CONFIG -&gt; default_tasks<a class="headerlink" href="#doit-config-default-tasks" title="Permalink to this headline">¶</a></h3>
<p><em>dodo</em> file defines a dictionary <code class="docutils literal notranslate"><span class="pre">DOIT_CONFIG</span></code> with <code class="docutils literal notranslate"><span class="pre">default_tasks</span></code>, a list of strings where each element is a task name.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  t1</span>
<span class="go">.  t3</span>
</pre></div>
</div>
<p>Note that only the task <em>t3</em> was specified to be executed by default.
But its dependencies include a target of another task (t1).
So that task was automatically executed also.</p>
</section>
<section id="command-line-selection">
<h3>command line selection<a class="headerlink" href="#command-line-selection" title="Permalink to this headline">¶</a></h3>
<p>From the command line you can control which tasks are going to be execute by passing its task name. Any number of tasks can be passed as positional arguments.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit t2
<span class="go">.  t2</span>
</pre></div>
</div>
<p>You can also specify which task to execute by its target:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit task1
<span class="go">.  t1</span>
</pre></div>
</div>
</section>
<section id="sub-task-selection">
<h3>sub-task selection<a class="headerlink" href="#sub-task-selection" title="Permalink to this headline">¶</a></h3>
<p>You can select sub-tasks from the command line specifying its full name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_create_file</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;file</span><span class="si">%d</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
               <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;touch </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit create_file:file2.txt
<span class="go">.  create_file:file2.txt</span>
</pre></div>
</div>
</section>
<section id="wildcard-selection">
<h3>wildcard selection<a class="headerlink" href="#wildcard-selection" title="Permalink to this headline">¶</a></h3>
<p>You can also select tasks to be executed using a <a class="reference external" href="http://docs.python.org/library/glob.html">glob</a> like syntax (it must contains a <code class="docutils literal notranslate"><span class="pre">*</span></code>).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit <span class="s2">&quot;create_file:file*&quot;</span>
<span class="go">.  create_file:file1.txt</span>
<span class="go">.  create_file:file2.txt</span>
<span class="go">.  create_file:file3.txt</span>
</pre></div>
</div>
</section>
</section>
<section id="parameters-on-actions">
<h2>parameters on actions<a class="headerlink" href="#parameters-on-actions" title="Permalink to this headline">¶</a></h2>
<p>Actions may take optional parameters provided as function keywords arguments for <em>python-action</em>. Or values for <em>printf-style</em> formatting on <em>cmd-action</em>.</p>
<p>There are three sources of parameter values:</p>
<blockquote>
<div><ul class="simple">
<li><p>specified on action’s <cite>kwargs</cite> definition</p></li>
<li><p>keywords with task metadata such as <cite>dependencies</cite>, <cite>changed</cite>, <cite>targets</cite> and <cite>task</cite></p></li>
<li><p>values computed in other tasks. <a class="reference internal" href="dependencies.html#getargs"><span class="std std-ref">getargs</span></a> describes, how a task can calculate and store values and how other tasks can refer to them.</p></li>
</ul>
</div></blockquote>
<section id="keywords-with-task-metadata">
<h3>keywords with task metadata<a class="headerlink" href="#keywords-with-task-metadata" title="Permalink to this headline">¶</a></h3>
<p>These values are automatically calculated by <cite>doit</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>dependencies</cite>: list of <cite>file_dep</cite></p></li>
<li><p><cite>changed</cite>: list of <cite>file_dep</cite> that changed since last
successful execution</p></li>
<li><p><cite>targets</cite>: list of <cite>targets</cite></p></li>
<li><p><cite>task</cite>: only available to <em>python-action</em>.
Note: the value is a <cite>Task</cite> object instance, not the metadata <em>dict</em>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="keywords-on-cmd-action-string">
<span id="id5"></span><h3>keywords on cmd-action string<a class="headerlink" href="#keywords-on-cmd-action-string" title="Permalink to this headline">¶</a></h3>
<p>For <em>cmd-action</em> you can take advantage of implicit keyword
substitution on <em>cmd-action</em> strings using python formatting.</p>
<p>Both <a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">format-string-syntax</a> and <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#old-string-formatting">old-string-formatting</a> are available and
are controlled by <code class="docutils literal notranslate"><span class="pre">DOIT_CONFIG</span></code> value of <code class="docutils literal notranslate"><span class="pre">action_string_formatting</span></code>.
It can be:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'old'</span></code> uses <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#old-string-formatting">old-string-formatting</a> (<code class="docutils literal notranslate"><span class="pre">%</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'new'</span></code> uses  <a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">format-string-syntax</a> (<code class="docutils literal notranslate"><span class="pre">{{}}</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'both'</span></code> both old and new style</p></li>
</ul>
</div></blockquote>
<p>The keyword value is a string containing all respective
file names separated by a space (” “).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DOIT_CONFIG</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action_string_formatting&#39;</span><span class="p">:</span> <span class="s1">&#39;both&#39;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">task_report_deps</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Report dependencies and changed dependencies to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;req.in&#39;</span><span class="p">,</span> <span class="s1">&#39;req-dev.in&#39;</span><span class="p">],</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="c1"># New style formatting</span>
                <span class="s1">&#39;echo D: </span><span class="si">{dependencies}</span><span class="s1">, CH: </span><span class="si">{changed}</span><span class="s1"> &gt; </span><span class="si">{targets}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="c1"># Old style formatting</span>
                <span class="s1">&#39;cat </span><span class="si">%(targets)s</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="p">],</span>
        <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;report.txt&#39;</span><span class="p">],</span>
        <span class="p">}</span>

</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">action_string_formatting</span></code> default value (as of <cite>doit</cite> version <strong>0.32</strong>) is <code class="docutils literal notranslate"><span class="pre">'old'</span></code>. This default value might change in future versions, it is advised to always explicitly state a value.</p>
</div>
<p>Before the string is actually executed, it is always formatted using
the formatters specified in <cite>DOIT_CONFIG</cite>. Make sure to escape your formatters
control characters, namely <cite>{</cite> and <cite>}</cite> for <a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">format-string-syntax</a> and <cite>%</cite> for
<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#old-string-formatting">old-string-formatting</a>. This is done by doubling them, so <cite>%</cite> becomes <cite>%%</cite> and so on.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>cmd-action</em> may have the form of a string (as <cite>“echo hello world”</cite>)
or list of arguments (as <cite>[“echo”, “hello”, “world”]</cite>).
Implicit keywords substitution applies only to the string form
and does not affect the list form. This means <cite>{}</cite> and <cite>%</cite>
need not be escaped when using this form.</p>
</div>
</section>
<section id="keywords-on-python-action">
<h3>keywords on <em>python-action</em><a class="headerlink" href="#keywords-on-python-action" title="Permalink to this headline">¶</a></h3>
<p>For <em>python-action</em> add a keyword parameter in the function,
<cite>doit</cite> will take care of passing the value when the function is called.
<cite>dependencies</cite>, <cite>changed</cite>, <cite>targets</cite> are passed as list of strings.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;hello&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">python_hello</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Python says Hello World!!!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">python_hello</span><span class="p">],</span>
        <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hello.txt&quot;</span><span class="p">],</span>
        <span class="p">}</span>

</pre></div>
</div>
<p>You can also pass the keyword <cite>task</cite> to have a reference to all task
metadata.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">who</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;my name is&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">task_x</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">who</span><span class="p">],</span>
        <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;asdf&#39;</span><span class="p">],</span>
        <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible not only to retrieve task’s attributes but also to
modify them while the action is running!</p>
</div>
</section>
</section>
<section id="private-hidden-tasks">
<h2>private/hidden tasks<a class="headerlink" href="#private-hidden-tasks" title="Permalink to this headline">¶</a></h2>
<p>If task name starts with an underscore ‘_’, it will not be included in the output.</p>
</section>
<section id="title">
<h2>title<a class="headerlink" href="#title" title="Permalink to this headline">¶</a></h2>
<p>By default when you run <cite>doit</cite> only the task name is printed out on the output.
You can customize the output passing a <code class="docutils literal notranslate"><span class="pre">title</span></code> function to the task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span> <span class="nf">show_cmd</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;executing... </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">task</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">task_custom_display</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:[</span><span class="s1">&#39;echo abc efg&#39;</span><span class="p">],</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">show_cmd</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  executing... Cmd: echo abc efg</span>
</pre></div>
</div>
</section>
<section id="verbosity">
<span id="id6"></span><h2>verbosity<a class="headerlink" href="#verbosity" title="Permalink to this headline">¶</a></h2>
<p>By default the stdout from a task is captured and its stderr is sent to the
console. If the task fails or there is an error the stdout and a traceback
(if any) is displayed.</p>
<p>There are 3 levels of verbosity:</p>
<dl class="simple">
<dt>0:</dt><dd><p>capture (do not print) stdout/stderr from task.</p>
</dd>
<dt>1 (default):</dt><dd><p>capture stdout only.</p>
</dd>
<dt>2:</dt><dd><p>do not capture anything (print everything immediately).</p>
</dd>
</dl>
<p>You can control the verbosity by:</p>
<ul class="simple">
<li><p>task attribute verbosity</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_print</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo hello&#39;</span><span class="p">],</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>doit
<span class="go">.  print</span>
<span class="go">hello</span>
</pre></div>
</div>
<ul class="simple">
<li><p>from command line, see <a class="reference internal" href="cmd-run.html#verbosity-option"><span class="std std-ref">verbosity option</span></a>.</p></li>
</ul>
</section>
<section id="meta">
<h2>meta<a class="headerlink" href="#meta" title="Permalink to this headline">¶</a></h2>
<p>You can pass <em>extra</em> metadata (dict) to a task through the <strong>meta</strong> attribute.
This could be used by custom commands or plugins.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">task_unittest</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo unit-test&#39;</span><span class="p">],</span>
        <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]},</span>
        <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id7">
<h2>pathlib<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p><cite>doit</cite> supports <a class="reference external" href="https://docs.python.org/3/library/pathlib.html">pathlib</a>:
file_dep, targets and CmdAction specified as a list can take as elements not
only strings but also instances of any Path class from pathlib.</p>
<p>Lets take the compilation example and modify it to work with any number
of header and source files in current directory using pathlib.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">task_compile</span><span class="p">():</span>
    <span class="n">working_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="c1"># Path.glob returns an iterator so turn it into a list</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">working_directory</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.h&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">source_file</span> <span class="ow">in</span> <span class="n">working_directory</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.c&#39;</span><span class="p">):</span>
        <span class="n">object_file</span> <span class="o">=</span> <span class="n">source_file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.o&#39;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">object_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">source_file</span><span class="p">]],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">source_file</span><span class="p">]</span> <span class="o">+</span> <span class="n">headers</span><span class="p">,</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">object_file</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="install.html"
       title="previous chapter">← Installing</a>
  </li>
  <li class="next">
    <a href="dependencies.html"
       title="next chapter">Non-file dependencies →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2008-2020, Eduardo Schettino.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
  
    
  
    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-29887834-3', 'auto');
        ga('send', 'pageview');
      </script>
    
  

  </body>
</html>