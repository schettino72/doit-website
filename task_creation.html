

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>More on Task creation &mdash; doit 0.31 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favico.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command line interface - run" href="cmd_run.html" />
    <link rel="prev" title="More on dependencies" href="dependencies.html" />
<style>
/* FIX for https://github.com/rtfd/sphinx_rtd_theme/pull/657
   pre.literal-block, div[class^='highlight'] pre, .linenodiv pre {
   line-height: 1.4 !important;
   }
*/

  /* FIX: handle code-block-caption
  https://github.com/rtfd/sphinx_rtd_theme/issues/292
  */
pre {
  font-size: 0.95em !important;
  letter-spacing: 0.015em;
  line-height: 120% !important; /* also fix 657 */
  padding: 0.5em;
  border: 1px solid #ccc;
  background-color: #f8f8f8;
}
pre.literal-block, div[class^='highlight'], div[class^='highlight-python3'] {
  margin-top: 0px !important;
}
div.code-block-caption {
  background-color: #ddd;
  color: #222;
  border: 1px solid #ccc;
}
div.code-block-caption {
  padding: 2px 5px;
  font-size: small;
}
a.headerlink {
  visibility: hidden;
  color: #c60f0f!important;
  font-size: 1em;
  margin-left: 6px;
  padding: 0 4px 0 4px;
  text-decoration: none!important;
}
a.headerlink:after{
  margin-left: 0px;
  content:"";
  font-family:FontAwesome;
}
.code-block-caption:hover .headerlink:after {
  visibility:visible;
}

/* CHANGE: code displayed in red color is too aggresive */
code {
    background-color: #f2f2f2;
    border-bottom: 1px solid #ddd;
    color: #333;
}
code.literal {
  color: inherit !important;
}

/* FIX: use full hight of nav-side (not version selector) */
.wy-nav-side {
  padding-bottom: 0px !important;
}
.wy-menu-vertical {
  padding-bottom: 15px !important;
}

/* FIX: revert rtd messing up with every image in nav-search */
.wy-side-nav-search img.logo, .wy-nav-top img.logo {
    display: inherit !important;
    margin: inherit !important;
    height: inherit !important;
    width: inherit !important;
    background-color: inherit !important;
    padding: 5px;
    border-radius: inherit !important;
}

</style>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29887834-3', 'auto');
  ga('send', 'pageview');
</script>




  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  <div style="text-align:left">
    <a href="index.html">
      <img src="_static/doit-logo-small.png" alt="doit logo" class="logo">
    </a>
    <span style="font-size:x-large;padding:0px 20px;"><a href="https://twitter.com/py_doit" style="color:black"><i class="fa fa-twitter"></i></a></span>
    <span style="font-size:x-large;padding:0px";><a href="https://github.com/pydoit/doit" style="color:black"><i class="fa fa-github"></i></a></span>
  </div>
  <div style="color:rgba(1,1,1,0.3); text-align:left; margin:10px;">
    
      
        <span>0.31</span>
      
    
  </div>
  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_1.html">tutorial 1 - basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">More on dependencies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">More on Task creation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#importing-tasks">importing tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#delayed-task-creation">delayed task creation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parameter-creates">Parameter: <cite>creates</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-task-definition">custom task definition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cmd_run.html">Command line interface - run</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmd_other.html">Other Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_args.html">Passing Task Arguments from the command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="uptodate.html">custom uptodate</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending <cite>doit</cite></a></li>
</ul>
<p class="caption"><span class="caption-text">Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="stories.html">Success Stories</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="related.html">Related Projects</a></li>
</ul>

            
          
        </div>
        

  
    <div class="wy-side-nav-search" style="margin-bottom: 0px;">
      <h3>Donate</h3>

      <p><em>doit</em> is 100% open-source and maintained by individuals without any company backing it...</p>
      <p>If you consider <em>doit</em> to be a useful project, and would like to see it continue to be maintained and developed, please consider helping cover the development cost. Thriving project requires a maintainer to keep list of issues and list of pull requests short.</p>
    </div>

    <div class="wy-side-nav-search" style="color:black;background-color:#fcfcfc;border-right:black 1px solid;">
      <h6 style="margin-bottom:5px;margin-top:5px;">OpenCollective</h6>
      <div>
        <object type="image/svg+xml" data="https://opencollective.com/doit/tiers/backers.svg?avatarHeight=60&width=200"></object>
      </div>

      <hr style="margin-top:5px;">
      <h6 style="margin-bottom:20px;">Paypal</h6>
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" style="margin:auto;">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="hosted_button_id" value="GFU3BPVN586A6">
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" border="0" src="https://www.paypalobjects.com/pt_BR/i/scr/pixel.gif" width="1" height="1" style="visibility:hidden;">
      </form>
    </div>
    <br>
  

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
  <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
  <a href="index.html">
      <img src="_static/doit-logo-small.png" alt="doit logo" class="logo">
  </a>
  <span style="font-size:x-large;padding:0px 20px;"><a href="https://twitter.com/py_doit" style="color:black; display:inline-block; vertical-align:middle;"><i class="fa fa-twitter"></i></a></span>
  <span style="font-size:x-large;padding:0px";><a href="https://github.com/pydoit/doit" style="color:black; display:inline-block; vertical-align:middle;"><i class="fa fa-github"></i></a></span>

      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="contents.html">Docs</a> &raquo;</li>
        
      <li>More on Task creation</li>
    
    
   
   <span class="float-right" role="navigation" aria-label="breadcrumb navigation">
      
        <li>
          <a href="dependencies.html" title="More on dependencies" accesskey="p"><span class="fa fa-arrow-circle-left"></span> More on dependencies</a>
        </li>
      
      <li style="padding-right:5px">|</li>
      
        <li>
            <a href="cmd_run.html" title="Command line interface - run" accesskey="n">Command line interface - run <span class="fa fa-arrow-circle-right"></span></a>
        </li>
      
  </span>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="more-on-task-creation">
<h1>More on Task creation<a class="headerlink" href="#more-on-task-creation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="importing-tasks">
<h2>importing tasks<a class="headerlink" href="#importing-tasks" title="Permalink to this headline">¶</a></h2>
<p>The <em>doit</em> loader will look at <strong>all</strong> objects in the namespace of the <em>dodo</em>.
It will look for functions staring with <code class="docutils literal notranslate"><span class="pre">task_</span></code> and objects with
<code class="docutils literal notranslate"><span class="pre">create_doit_tasks</span></code>.
So it is also possible to load task definitions from other
modules just by importing them into your <em>dodo</em> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import task_ functions</span>
<span class="kn">from</span> <span class="nn">get_var</span> <span class="k">import</span> <span class="n">task_echo</span>

<span class="c1"># import tasks with create_doit_tasks callable</span>
<span class="kn">from</span> <span class="nn">custom_task_def</span> <span class="k">import</span> <span class="n">sample</span>


<span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo hello&#39;</span><span class="p">]}</span>

</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> doit list
<span class="go">echo</span>
<span class="go">hello</span>
<span class="go">sample</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Importing tasks from different modules is useful if you want to split
your task definitions in different modules.</p>
<p class="last">The best way to create re-usable tasks that can be used in several projects
is to call functions that return task dict’s.
For example take a look at a reusable <em>pyflakes</em>
<a class="reference external" href="https://github.com/pydoit/doit-py/blob/master/doitpy/pyflakes.py">task generator</a>.
Check the project <a class="reference external" href="https://github.com/pydoit/doit-py">doit-py</a>
for more examples.</p>
</div>
</div>
<div class="section" id="delayed-task-creation">
<span id="id1"></span><h2>delayed task creation<a class="headerlink" href="#delayed-task-creation" title="Permalink to this headline">¶</a></h2>
<p><cite>doit</cite> execution model is divided in two phases:</p>
<blockquote>
<div><ul class="simple">
<li><em>task-loading</em> : search for task-creator functions (that starts with string <cite>task_</cite>) and create task metadata</li>
<li><em>task-execution</em> : check which tasks are out-of-date and execute them</li>
</ul>
</div></blockquote>
<p>Normally <em>task-loading</em> is completed before the <em>task-execution</em> starts.
<cite>doit</cite> allows some task metadata to be modified during <em>task-execution</em> with
<cite>calc_deps</cite> and on <cite>uptodate</cite>, but those are restricted to modifying
already created tasks…</p>
<p>Sometimes it is not possible to know all tasks that should be created before
some tasks are executed. For these cases <cite>doit</cite> supports
<em>delayed task creation</em>, that means <em>task-execution</em> starts before
<em>task-loading</em> is completed.</p>
<p>When <em>task-creator</em> function is decorated with <cite>doit.create_after</cite>,
its evaluation to create the tasks will be delayed to happen after the
execution of the specified task in the <cite>executed</cite> param.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">from</span> <span class="nn">doit</span> <span class="k">import</span> <span class="n">create_after</span>


<span class="nd">@create_after</span><span class="p">(</span><span class="n">executed</span><span class="o">=</span><span class="s1">&#39;early&#39;</span><span class="p">,</span> <span class="n">target_regex</span><span class="o">=</span><span class="s1">&#39;.*\.out&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">task_build</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.in&#39;</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">inf</span><span class="p">,</span>
            <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cp </span><span class="si">%(dependencies)s</span><span class="s1"> </span><span class="si">%(targets)s</span><span class="s1">&#39;</span><span class="p">],</span>
            <span class="s1">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">inf</span><span class="p">],</span>
            <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">inf</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">],</span>
            <span class="s1">&#39;clean&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>

<span class="k">def</span> <span class="nf">task_early</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;a task that create some files...&quot;&quot;&quot;</span>
    <span class="n">inter_files</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a.in&#39;</span><span class="p">,</span> <span class="s1">&#39;b.in&#39;</span><span class="p">,</span> <span class="s1">&#39;c.in&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;touch </span><span class="si">%(targets)s</span><span class="s1">&#39;</span><span class="p">],</span>
        <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="n">inter_files</span><span class="p">,</span>
        <span class="s1">&#39;clean&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note" id="specify-target-regex">
<p class="first admonition-title">Note</p>
<p>To be able to specify targets created by delayed task loaders to <cite>doit run</cite>,
it is possible to also specify a regular expression (regex) for every
delayed task loader. If specified, this regex should match any target name
possibly generated by this delayed task generator. It can be specified via
the additional <em>task-generator</em> argument <cite>target_regex</cite>. In the above example,
the regex <cite>.*.out</cite> matches every target name ending with <cite>.out</cite>.</p>
<p class="last">It is possible to match every possible target name by specifying <cite>.*</cite>.
Alternatively, one can use the command line option <cite>–auto-delayed-regex</cite>
to <cite>doit run</cite>; see <a class="reference internal" href="cmd_run.html#auto-delayed-regex"><span class="std std-ref">here</span></a> for more information.</p>
</div>
<div class="section" id="parameter-creates">
<h3>Parameter: <cite>creates</cite><a class="headerlink" href="#parameter-creates" title="Permalink to this headline">¶</a></h3>
<p>In case the task created by a <cite>DelayedTask</cite> has a different <em>basename</em> than
then creator function, or creates several tasks with different <em>basenames</em>,
you should pass the parameter <cite>creates</cite>.</p>
<p>Since <cite>doit</cite> will only execute the body of the task-creator function on demand,
the tasks names must be explicitly specified… Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">doit</span> <span class="k">import</span> <span class="n">create_after</span>

<span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">your_name</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello from </span><span class="si">{}</span><span class="s2">!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">your_name</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">task_a</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="p">(</span><span class="n">say_hello</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">])</span> <span class="p">]</span>
    <span class="p">}</span>

<span class="nd">@create_after</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">creates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">task_another_task</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;basename&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="p">(</span><span class="n">say_hello</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">])</span> <span class="p">],</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><cite>doit</cite> normally automatically sets <cite>task_dep</cite> between tasks by checking
the relation of <cite>file_dep</cite> and <cite>targets</cite>.
Due to performance reasons, these <cite>task_dep</cite> relations are NOT computed
for delayed-task’s <cite>targets</cite>.
This problem can avoided by ordering the creation of delayed-tasks with
the expected order of execution.</p>
</div>
</div>
</div>
<div class="section" id="custom-task-definition">
<span id="create-doit-tasks"></span><h2>custom task definition<a class="headerlink" href="#custom-task-definition" title="Permalink to this headline">¶</a></h2>
<p>Apart from collect functions that start with the name <cite>task_</cite>.
The <em>doit</em> loader will also execute the <code class="docutils literal notranslate"><span class="pre">create_doit_tasks</span></code>
callable from any object that contains this attribute.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_task</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;make decorated function a task-creator&quot;&quot;&quot;</span>
    <span class="n">func</span><span class="o">.</span><span class="n">create_doit_tasks</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">func</span>

<span class="nd">@make_task</span>
<span class="k">def</span> <span class="nf">sample</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;echo hi&#39;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://bitbucket.org/takluyver/letsdoit">project letsdoit</a>
has some real-world implementations.</p>
<p>For simple examples to help you create your own check this
<a class="reference external" href="http://blog.schettino72.net/posts/doit-task-creation.html">blog post</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cmd_run.html" class="btn btn-neutral float-right" title="Command line interface - run" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dependencies.html" class="btn btn-neutral" title="More on dependencies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2008-2018, Eduardo Schettino.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.31',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>