<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>More on Task creation &mdash; doit - automation tool</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.29',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favico.ico"/>
    <link rel="top" title="doit - automation tool" href="contents.html" />
    <link rel="next" title="custom uptodate" href="uptodate.html" />
    <link rel="prev" title="Passing Task Arguments from the command line" href="task_args.html" />
<style>
  body {
    font-size: 16px;
  }

  div.topic {
    padding: 0;
    background-color: #F8F4A6;
    border: 1px solid #D8D486;
  }

  div.topic p.first {
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    background-color: #E8E496;
    border-bottom: 1px solid #C8C476;
  }

  div.topic p {
    margin: 0.5em 1em 0.5em 1em;
  }

  p.topic-title {
    display: run-in;
    margin-right: 15px;
  }

  a.external-link {
    background: url(_static/external.png) center right no-repeat;
    padding-right: 13px;
  }

  div.related ul li a.external-link {
    padding-right: 13px;
  }

  .sidebartext {
    font-size: 75%;
    line-height: 130%;
  }

</style>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29887834-3', 'auto');
  ga('send', 'pageview');
</script>



  </head>
  <body role="document">
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 50px">
<img src="_static/doit.png" alt="doit logo" />
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="uptodate.html" title="custom uptodate"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="task_args.html" title="Passing Task Arguments from the command line"
             accesskey="P">previous</a> |</li>
  <li><a href="index.html">Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&nbsp;|&nbsp;</li>
  <!-- TODO news -->
  <li><a class="external-link" href="https://github.com/pydoit/doit">Code</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="https://github.com/pydoit/doit/issues">Issues</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://pypi.python.org/pypi/doit">Download</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://groups.google.co.in/group/python-doit">Forum</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="https://twitter.com/py_doit">Twitter</a></li>
 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">More on Task creation</a><ul>
<li><a class="reference internal" href="#importing-tasks">importing tasks</a></li>
<li><a class="reference internal" href="#delayed-task-creation">delayed task creation</a><ul>
<li><a class="reference internal" href="#parameter-creates">Parameter: <cite>creates</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-task-definition">custom task definition</a></li>
</ul>
</li>
</ul>



<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

<h3>Sponsors</h3>
<em>Your logo here</em>

<h3>Sponsor/Donate</h3>


<div data-gratipay-username="schettino72" data-gratipay-widget="custom">
  <div><a class="gratipay-profile-link">Gratipay</a> weekly funding goal is <span class="gratipay-goal">$?.??</span> USD.
  </div>
  <div style="position:relative;background-color:#2F2D2D;color:#DDDDDD;border-radius:5px;margin:3px 5px;padding:3px 0;">
    <div class="gratipay-goal-progress-bar" style="position:absolute;top:3px;background-color:#008000;height:24px;border-radius:2px;"></div>
    <span class="gratipay-receiving" style="position:relative;padding-left:6px;">$?.??</span>
  </div>
</div>
<script src="//grtp.co/v1.js"></script>

<br/>

<div class="sidebartext">
If you use <em>doit</em> and think it is a useful project. Please consider to make a donation to support the developer/maintainer with maintanance tasks (bug fixes, merge patches, reply users) and further development.<br/>
  <script data-gratipay-username="schettino72"
        data-gratipay-widget="button"
        src="//gttp.co/v1.js"></script>
<br/>
If you use it at work, ask your company to sponsor the project. The logo of your company will be placed on this website side-bar (see above). For more information please contact <em>schettino72</em>&#64<span>gmail.com</span><br/>
</div>

<h3>Hire me</h3>
<div class="sidebartext">
Looking for a python developer with a proven record of designing and developing
robust and well tested applications?
The creator and maintainer of <em>doit</em> is available for hire.
Full-time, part-time or one-off job.
<br/>
Contact: <em>schettino72</em>&#64<span>gmail.com</span>
</div>




<h3></h3>
<a href="http://python.org"><img src="_static/python-powered-w-100x40.png" /></a><br/><br/>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="more-on-task-creation">
<h1>More on Task creation<a class="headerlink" href="#more-on-task-creation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="importing-tasks">
<h2>importing tasks<a class="headerlink" href="#importing-tasks" title="Permalink to this headline">¶</a></h2>
<p>The <em>doit</em> loader will look at <strong>all</strong> objects in the namespace of the <em>dodo</em>.
It will look for functions staring with <code class="docutils literal"><span class="pre">task_</span></code> and objects with
<code class="docutils literal"><span class="pre">create_doit_tasks</span></code>.
So it is also possible to load task definitions from other
modules just by importing them into your <em>dodo</em> file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># import task_ functions</span>
<span class="kn">from</span> <span class="nn">get_var</span> <span class="kn">import</span> <span class="n">task_echo</span>

<span class="c"># import tasks with create_doit_tasks callable</span>
<span class="kn">from</span> <span class="nn">custom_task_def</span> <span class="kn">import</span> <span class="n">sample</span>


<span class="k">def</span> <span class="nf">task_hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hello&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> doit list
<span class="go">echo</span>
<span class="go">hello</span>
<span class="go">sample</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Importing tasks from different modules is useful if you want to split
your task definitions in different modules.</p>
<p class="last">The best way to create re-usable tasks that can be used in several projects
is to call functions that return task dict&#8217;s.
For example take a look at a reusable <em>pyflakes</em>
<a class="reference external" href="https://github.com/pydoit/doit-py/blob/master/doitpy/pyflakes.py">task generator</a>.
Check the project <a class="reference external" href="https://github.com/pydoit/doit-py">doit-py</a>
for more examples.</p>
</div>
</div>
<div class="section" id="delayed-task-creation">
<span id="id1"></span><h2>delayed task creation<a class="headerlink" href="#delayed-task-creation" title="Permalink to this headline">¶</a></h2>
<p><cite>doit</cite> execution model is divided in two phases:</p>
<blockquote>
<div><ul class="simple">
<li><em>task-loading</em> : search for task-creator functions (that starts with string <cite>task_</cite>) and create task metadata</li>
<li><em>task-execution</em> : check which tasks are out-of-date and execute them</li>
</ul>
</div></blockquote>
<p>Normally <em>task-loading</em> is completed before the <em>task-execution</em> starts.
<cite>doit</cite> allows some task metadata to be modified during <em>task-execution</em> with
<cite>calc_deps</cite> and on <cite>uptodate</cite>, but those are restricted to modifying
already created tasks...</p>
<p>Sometimes it is not possible to know all tasks that should be created before
some tasks are executed. For these cases <cite>doit</cite> supports
<em>delayed task creation</em>, that means <em>task-execution</em> starts before
<em>task-loading</em> is completed.</p>
<p>When <em>task-creator</em> function is decorated with <cite>doit.create_after</cite>,
its evaluation to create the tasks will be delayed to happen after the
execution of the specified task in the <cite>executed</cite> param.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">from</span> <span class="nn">doit</span> <span class="kn">import</span> <span class="n">create_after</span>


<span class="nd">@create_after</span><span class="p">(</span><span class="n">executed</span><span class="o">=</span><span class="s">&#39;early&#39;</span><span class="p">,</span> <span class="n">target_regex</span><span class="o">=</span><span class="s">&#39;.*\.out&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">task_build</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.in&#39;</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">inf</span><span class="p">,</span>
            <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;cp </span><span class="si">%(dependencies)s</span><span class="s"> </span><span class="si">%(targets)s</span><span class="s">&#39;</span><span class="p">],</span>
            <span class="s">&#39;file_dep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">inf</span><span class="p">],</span>
            <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">inf</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.out&#39;</span><span class="p">],</span>
            <span class="s">&#39;clean&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">}</span>

<span class="k">def</span> <span class="nf">task_early</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;a task that create some files...&quot;&quot;&quot;</span>
    <span class="n">inter_files</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a.in&#39;</span><span class="p">,</span> <span class="s">&#39;b.in&#39;</span><span class="p">,</span> <span class="s">&#39;c.in&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;touch </span><span class="si">%(targets)s</span><span class="s">&#39;</span><span class="p">],</span>
        <span class="s">&#39;targets&#39;</span><span class="p">:</span> <span class="n">inter_files</span><span class="p">,</span>
        <span class="s">&#39;clean&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since the metadata of a delayed task is only created on demand,
it is currently not possible to set a <cite>basename</cite> for delayed tasks.
That is because <em>doit</em> needs to know which task-creator function should be
executed in order to create the requested task. See this
<a class="reference external" href="https://github.com/pydoit/doit/issues/30">issue</a> for a proposed solution.</p>
</div>
<div class="admonition note" id="specify-target-regex">
<p class="first admonition-title">Note</p>
<p>To be able to specify targets created by delayed task loaders to <cite>doit run</cite>,
it is possible to also specify a regular expression (regex) for every
delayed task loader. If specified, this regex should match any target name
possibly generated by this delayed task generator. It can be specified via
the additional <em>task-generator</em> argument <cite>target_regex</cite>. In the above example,
the regex <cite>.*\.out</cite> matches every target name ending with <cite>.out</cite>.</p>
<p class="last">It is possible to match every possible target name by specifying <cite>.*</cite>.
Alternatively, one can use the command line option <cite>&#8211;auto-delayed-regex</cite>
to <cite>doit run</cite>; see <a class="reference internal" href="cmd_run.html#auto-delayed-regex"><span>here</span></a> for more information.</p>
</div>
<div class="section" id="parameter-creates">
<h3>Parameter: <cite>creates</cite><a class="headerlink" href="#parameter-creates" title="Permalink to this headline">¶</a></h3>
<p>In case the task created by a <cite>DelayedTask</cite> has a different <em>basename</em> than
then creator function, or creates several tasks with different <em>basenames</em>,
you should pass the parameter <cite>creates</cite>.</p>
<p>Since <cite>doit</cite> will only execute the body of the task-creator function on demand,
the tasks names must be explicitly specified... Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">doit</span> <span class="kn">import</span> <span class="n">create_after</span>

<span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">your_name</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Hello from {}!</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">your_name</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">task_a</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&quot;actions&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="p">(</span><span class="n">say_hello</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">])</span> <span class="p">]</span>
    <span class="p">}</span>

<span class="nd">@create_after</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">creates</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">task_another_task</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&quot;basename&quot;</span><span class="p">:</span> <span class="s">&quot;b&quot;</span><span class="p">,</span>
        <span class="s">&quot;actions&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="p">(</span><span class="n">say_hello</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">])</span> <span class="p">],</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-task-definition">
<span id="create-doit-tasks"></span><h2>custom task definition<a class="headerlink" href="#custom-task-definition" title="Permalink to this headline">¶</a></h2>
<p>Apart from collect functions that start with the name <cite>task_</cite>.
The <em>doit</em> loader will also execute the <code class="docutils literal"><span class="pre">create_doit_tasks</span></code>
callable from any object that contains this attribute.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">make_task</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;make decorated function a task-creator&quot;&quot;&quot;</span>
    <span class="n">func</span><span class="o">.</span><span class="n">create_doit_tasks</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">func</span>

<span class="nd">@make_task</span>
<span class="k">def</span> <span class="nf">sample</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;echo hi&#39;</span><span class="p">],</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://bitbucket.org/takluyver/letsdoit">project letsdoit</a>
has some real-world implementations.</p>
<p>For simple examples to help you create your own check this
<a class="reference external" href="http://blog.schettino72.net/posts/doit-task-creation.html">blog post</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="uptodate.html" title="custom uptodate"
             >next</a></li>
        <li class="right" >
          <a href="task_args.html" title="Passing Task Arguments from the command line"
             >previous</a> |</li>
  <li><a href="index.html">Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&nbsp;|&nbsp;</li>
  <!-- TODO news -->
  <li><a class="external-link" href="https://github.com/pydoit/doit">Code</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="https://github.com/pydoit/doit/issues">Issues</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://pypi.python.org/pypi/doit">Download</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="http://groups.google.co.in/group/python-doit">Forum</a>&nbsp;|&nbsp;</li>
  <li><a class="external-link" href="https://twitter.com/py_doit">Twitter</a></li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2008-2015, Eduardo Schettino.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>